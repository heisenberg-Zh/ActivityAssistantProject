# 测试数据说明文档

## 📊 测试数据概览

**插入日期**: 2025-11-17
**数据库**: activity_assistant
**数据范围**: 6个测试活动、29条报名记录、7条签到记录

所有测试数据的ID都以 `TEST_` 或 `REG_TEST_` 或 `CHECKIN_TEST_` 开头，便于识别和管理。

---

## 🎯 测试活动列表

### 1. TEST_PUBLIC_UPCOMING - 周末篮球友谊赛
**测试场景**: 即将开始的公开活动（可编辑、可报名、可管理）

- **创建者**: u7d3f31690438（当前测试用户）
- **类型**: 运动
- **状态**: published（已发布）
- **可见性**: 公开活动
- **时间**: 3天后开始，持续2小时
- **地点**: 朝阳公园篮球场
- **人数**: 上限20人，已报名5人，最少10人成行
- **费用**: 免费
- **需要审核**: 否

**报名情况**:
- 当前用户（u7d3f31690438）+ 4位测试用户（u1-u4）
- 所有报名状态均为 approved（已通过）

**测试用途**:
- 测试活动编辑功能
- 测试报名管理功能
- 测试活动取消和修改流程
- 测试"我的活动-创建的"列表显示

---

### 2. TEST_PUBLIC_ONGOING - 编程技术分享会
**测试场景**: 正在进行的公开活动（可签到）

- **创建者**: u7d3f31690438（当前测试用户）
- **类型**: 培训
- **状态**: ongoing（进行中）
- **可见性**: 公开活动
- **时间**: 1小时前开始，还剩2小时结束
- **地点**: 中关村创业大街3W咖啡
- **人数**: 上限30人，已报名7人，最少10人成行
- **费用**: 免费
- **需要审核**: 否

**报名情况**:
- 7人已通过审核（包括当前用户）
- 其中4人已签到（当前用户 + u1, u2, u3）
- 3人未签到（u4, u5, u6）

**签到记录**:
- 最早签到: 40分钟前（u1）
- 最晚签到: 25分钟前（u3）

**测试用途**:
- 测试签到功能
- 测试进行中活动的管理
- 测试签到统计和实时更新
- 测试迟到检测（如果时间逻辑启用）

---

### 3. TEST_PUBLIC_FINISHED - 上周羽毛球活动
**测试场景**: 已结束的公开活动（可查看统计、可评价）

- **创建者**: u7d3f31690438（当前测试用户）
- **类型**: 运动
- **状态**: finished（已结束）
- **可见性**: 公开活动
- **时间**: 7天前举办，持续2小时
- **地点**: 奥林匹克体育中心
- **人数**: 上限24人，已报名4人（全部参加），最少10人成行
- **费用**: 50元/人，AA制
- **需要审核**: 否

**报名情况**:
- 4人已通过审核并参加（当前用户 + u1, u2, u3）
- 全部4人均已签到

**签到记录**:
- 所有签到时间均为7天前（活动当天）

**测试用途**:
- 测试已结束活动的查看统计功能
- 测试活动评价功能
- 测试签到历史记录
- 测试"我的活动-创建的"列表中已结束活动的操作按钮
- 测试统计图表和数据分析

---

### 4. TEST_PRIVATE_REVIEW - 公司内部培训-产品发布会
**测试场景**: 私密活动，需要审核（测试权限和审核流程）

- **创建者**: u7d3f31690438（当前测试用户）
- **类型**: 会议
- **状态**: published（已发布）
- **可见性**: 私密活动（仅创建者和已报名者可见）
- **时间**: 5天后开始，持续3小时
- **地点**: 公司会议室A
- **人数**: 上限50人，已通过审核3人，最少20人成行
- **费用**: 免费
- **需要审核**: **是**

**报名情况**（共7条报名）:
- **pending（待审核）**: 3人（u1, u4, u6）
- **approved（已通过）**: 3人（u2, u5, 当前用户）
- **rejected（已拒绝）**: 1人（u3）

**测试用途**:
- 测试报名审核功能（批准/拒绝）
- 测试私密活动的权限控制
- 测试非创建者访问私密活动的拦截
- 测试待审核报名的管理页面
- 测试审核通知（如果实现）

---

### 5. TEST_WITH_GROUPS - 户外徒步活动-分难度分组
**测试场景**: 带分组的活动（测试分组功能）

- **创建者**: u7d3f31690438（当前测试用户）
- **类型**: 户外
- **状态**: published（已发布）
- **可见性**: 公开活动
- **时间**: 10天后开始，持续6小时
- **地点**: 香山公园
- **总人数**: 上限60人（分3组），已报名5人
- **费用**: 分组不同（初级50元、进阶80元、高级150元），AA制
- **需要审核**: 否

**分组配置**:
1. **g1 - 初级组**: 上限30人，已报名3人（当前用户, u1, u2），费用50元
   - 描述: 适合初次参加户外活动的朋友
   - 要求: 无特殊要求

2. **g2 - 进阶组**: 上限20人，已报名1人（u3），费用80元
   - 描述: 适合有一定户外经验的朋友
   - 要求: 需要有登山经验

3. **g3 - 高级组**: 上限10人，已报名1人（u4），费用150元
   - 描述: 适合资深户外爱好者
   - 要求: 需要提供户外装备清单

**报名情况**:
- 初级组: 当前用户, u1, u2
- 进阶组: u3
- 高级组: u4

**测试用途**:
- 测试分组活动的创建和编辑
- 测试报名时的分组选择
- 测试不同分组的人数统计
- 测试分组的费用差异化管理
- 测试分组报名列表的筛选和显示

---

### 6. TEST_OTHERS_PUBLIC - 周末聚餐活动
**测试场景**: 别人创建的活动（测试"我参加的"功能）

- **创建者**: u1（不是当前测试用户）
- **类型**: 聚会
- **状态**: published（已发布）
- **可见性**: 公开活动
- **时间**: 6天后开始，持续3小时
- **地点**: 三里屯某餐厅
- **人数**: 上限15人，已报名1人（当前用户），最少5人成行
- **费用**: 150元/人，AA制
- **需要审核**: 否

**报名情况**:
- 仅当前用户（u7d3f31690438）已报名并通过审核

**测试用途**:
- 测试"我的活动-参加的"列表显示
- 测试非创建者视角的活动详情页
- 测试参与者的操作权限（不能编辑、不能查看统计等）
- 测试取消报名功能

---

## 👥 测试用户账号

| 用户ID | 昵称 | 手机号 | 角色 |
|--------|------|--------|------|
| u7d3f31690438 | 用户7d3f31 | 138****1234 | **当前测试用户**（创建者/参与者） |
| u1 | 张小明 | 138****1234 | 参与者/另一个活动的创建者 |
| u2 | 李小红 | 139****5678 | 参与者 |
| u3 | 王小刚 | 136****9012 | 参与者（包含被拒绝的报名） |
| u4 | 赵小美 | 137****3456 | 参与者 |
| u5 | 孙小强 | 135****7890 | 参与者 |
| u6 | 周小芳 | 134****2345 | 参与者 |

---

## 🧪 测试场景覆盖

### 活动状态覆盖
✅ 已发布（published）- 4个活动
✅ 进行中（ongoing）- 1个活动
✅ 已结束（finished）- 1个活动

### 活动类型覆盖
✅ 运动 - 2个
✅ 培训 - 1个
✅ 会议 - 1个
✅ 户外 - 1个
✅ 聚会 - 1个

### 权限场景覆盖
✅ 公开活动 - 5个
✅ 私密活动 - 1个
✅ 需要审核的活动 - 1个
✅ 免审核活动 - 5个

### 报名状态覆盖
✅ 已通过（approved）- 24条
✅ 待审核（pending）- 3条
✅ 已拒绝（rejected）- 1条

### 功能场景覆盖
✅ 创建者视角（5个活动）
✅ 参与者视角（1个活动）
✅ 签到功能（7条签到记录）
✅ 分组功能（1个活动，3个分组）
✅ 报名审核（7条不同状态的报名）
✅ 已结束活动统计（1个活动）

---

## 📋 测试功能清单

### 1. 活动列表相关
- [ ] 首页活动列表显示（公开活动）
- [ ] 活动搜索和筛选功能
- [ ] 活动分类筛选（按类型）
- [ ] 活动状态筛选（进行中/即将开始/已结束）

### 2. 我的活动相关
- [ ] "我创建的"活动列表（应显示5个活动）
- [ ] "我参加的"活动列表（应显示1个活动）
- [ ] 不同状态活动的操作按钮
  - [ ] 即将开始：编辑、详情、复制、取消
  - [ ] 进行中：管理、详情
  - [ ] 已结束：查看统计、详情

### 3. 活动详情相关
- [ ] 公开活动详情页查看
- [ ] 私密活动权限检查（非创建者访问应拦截）
- [ ] 创建者查看自己的私密活动（应正常显示）
- [ ] 活动信息完整性（标题、描述、时间、地点等）
- [ ] 报名人数统计显示
- [ ] 分组信息显示（TEST_WITH_GROUPS）

### 4. 报名功能相关
- [ ] 用户报名功能
- [ ] 报名表单填写（姓名、手机号等）
- [ ] 分组选择（TEST_WITH_GROUPS活动）
- [ ] 报名成功后的状态显示
- [ ] 取消报名功能

### 5. 报名审核相关（TEST_PRIVATE_REVIEW）
- [ ] 待审核报名列表显示（3条pending）
- [ ] 批准报名功能
- [ ] 拒绝报名功能
- [ ] 审核后状态更新
- [ ] 已通过/已拒绝报名的查看

### 6. 签到功能相关
- [ ] 创建者查看签到列表
- [ ] 签到统计（已签到4/7人）
- [ ] 签到时间记录
- [ ] 签到地点验证（如果启用）
- [ ] 未签到人员提醒

### 7. 统计功能相关（TEST_PUBLIC_FINISHED）
- [ ] 活动统计页面访问
- [ ] 报名人数统计图表
- [ ] 签到率统计
- [ ] 参与者数据导出
- [ ] 签到记录查看

### 8. 活动管理相关
- [ ] 编辑活动信息
- [ ] 复制活动功能
- [ ] 取消活动
- [ ] 删除活动
- [ ] 活动权限管理

### 9. 权限控制相关
- [ ] 私密活动访问拦截
- [ ] 创建者权限校验
- [ ] 参与者权限限制
- [ ] 未登录用户访问限制

---

## 🔄 数据重置方法

如果需要重新插入测试数据，可以执行以下SQL清理命令：

```sql
DELETE FROM checkins WHERE activity_id LIKE 'TEST_%';
DELETE FROM registrations WHERE activity_id LIKE 'TEST_%';
DELETE FROM activities WHERE id LIKE 'TEST_%';
```

然后重新运行测试数据脚本：

```bash
mysql -u activity_user -pActivity@2025 activity_assistant --default-character-set=utf8mb4 < backend/test-data-final.sql
```

---

## ⚠️ 注意事项

1. **测试数据时效性**:
   - 时间字段使用相对时间（如 `DATE_ADD(NOW(), INTERVAL 3 DAY)`）
   - 每次重新插入时，活动时间会基于当前时间重新计算

2. **数据一致性**:
   - `joined` 字段已自动更新为实际 approved 状态的报名数量
   - 分组活动的总人数和各分组joined之和保持一致

3. **字符编码**:
   - 使用 `--default-character-set=utf8mb4` 确保中文正常插入
   - 数据库表应使用 utf8mb4 字符集

4. **依赖关系**:
   - 必须先删除 checkins，再删除 registrations，最后删除 activities
   - 外键约束顺序：checkins → registrations → activities

---

## 📝 文件清单

| 文件名 | 说明 |
|--------|------|
| `backend/test-data-final.sql` | 完整的测试数据SQL脚本（推荐使用） |
| `backend/test-data-simple.sql` | 简化版SQL脚本（字段不完整，已废弃） |
| `backend/insert_test_data.py` | Python插入脚本（字段不完整，已废弃） |
| `backend/insert_complete_test_data.py` | 完整Python脚本（未测试） |
| `backend/test-data-insert.sql` | 原始SQL脚本（包含不存在的字段，已废弃） |

**建议**: 使用 `backend/test-data-final.sql` 进行测试数据插入，该文件已验证可正常执行。

---

**文档创建日期**: 2025-11-17
**最后更新日期**: 2025-11-17
**维护人员**: 开发团队
