# 前后端集成测试指南

## ✅ 已完成的准备工作

### 1. 数据适配层实现 ✅

已创建 `utils/data-adapter.js` 文件，自动处理前后端数据格式差异：

**主要功能**：
- ✅ 字段名转换：`desc` ↔ `description`
- ✅ 日期格式转换：`'2025-12-23T19:00:00'` ↔ `'2025-12-23 19:00'`
- ✅ JSON字段解析：`groups`、`customFields`、`recurringConfig` 等
- ✅ 衍生字段计算：`date`、`timeRange`、`hasGroups`、`tags` 等
- ✅ 自动集成到 API 层，所有请求和响应自动转换

### 2. 环境配置 ✅

- ✅ 已切换到 **development 模式**
- ✅ API 地址：`http://localhost:8082`
- ✅ 数据适配器已启用

### 3. 后端服务状态

请确认后端服务正在运行：
```bash
cd backend
mvn spring-boot:run
```

**验证方法**：
访问 http://localhost:8082/api/health 应该返回 `{"status":"UP"}`

---

## 🧪 测试步骤

### 第一步：配置微信开发者工具

**重要**：必须禁用域名校验才能访问本地后端

1. 打开微信开发者工具
2. 点击右上角 **"详情"**
3. 选择 **"本地设置"** 标签页
4. ☑️ 勾选：**"不校验合法域名、web-view(业务域名)、TLS 版本以及 HTTPS 证书"**
5. 关闭详情窗口

---

### 第二步：编译并查看环境信息

1. 点击微信开发者工具的 **"编译"** 按钮
2. 打开 **"控制台"** 标签
3. 确认显示以下信息：

```
====== 环境配置 ======
当前环境: development
API地址: http://localhost:8082
使用Mock: false
环境说明: 开发环境（需在微信开发者工具中禁用域名校验）
====================
```

**如果显示不正确**，请检查 `utils/config.js` 中的 `CURRENT_ENV` 设置。

---

### 第三步：功能测试清单

#### 📌 测试1：活动列表

**测试页面**：首页 / 活动列表页

**测试步骤**：
1. 进入首页或活动列表页
2. 查看活动卡片是否正常显示
3. 检查控制台是否有网络请求错误

**预期结果**：
- ✅ 活动列表正常显示
- ✅ 活动标题、描述、时间、地点信息完整
- ✅ 控制台显示：`[API] GET /api/activities → 200`

**常见问题**：
- ❌ 显示"加载失败"：后端服务未启动
- ❌ `request:fail url not in domain list`：未禁用域名校验
- ❌ 数据显示为空：后端数据库无数据（正常，需先创建活动）

---

#### 📌 测试2：活动详情

**测试页面**：活动详情页

**测试步骤**：
1. 点击任意活动卡片
2. 进入活动详情页
3. 查看活动完整信息

**预期结果**：
- ✅ 活动详情完整显示
- ✅ 自定义字段正确解析
- ✅ 分组信息（如有）正确显示

**检查字段**：
- 活动描述（`desc` 字段）是否正确显示
- 开始时间、结束时间格式是否正确
- 报名截止时间是否显示

---

#### 📌 测试3：创建活动

**测试页面**：创建活动页

**测试步骤**：
1. 进入创建活动页面
2. 填写活动信息：
   - 标题：测试活动
   - 描述：这是一个测试活动
   - 类型：运动
   - 开始时间：未来某个时间
   - 结束时间：开始时间之后
   - 地点：测试地点
   - 人数上限：10
3. 点击"发布"按钮

**预期结果**：
- ✅ 提交成功，显示"创建成功"提示
- ✅ 跳转到活动详情页
- ✅ 新创建的活动显示在活动列表中

**检查后端日志**：
```
收到创建活动请求，标题: 测试活动
活动创建成功: {...}
```

**数据验证**：
- 前端提交的 `desc` 字段应该转换为后端的 `description`
- 时间格式应该从 `'2025-12-23 19:00'` 转换为 `'2025-12-23T19:00:00'`

---

#### 📌 测试4：报名功能

**测试页面**：报名页面

**前置条件**：至少有一个可报名的活动

**测试步骤**：
1. 进入活动详情页
2. 点击"报名"按钮
3. 填写报名信息：
   - 姓名：测试用户
   - 手机号：13800138000
4. 提交报名

**预期结果**：
- ✅ 提交成功，显示"报名成功"
- ✅ 活动详情页显示"已报名"状态
- ✅ 在"我的活动"中可以看到此活动

**检查后端日志**：
```
收到报名请求，活动ID: xxx
报名成功: {...}
```

---

#### 📌 测试5：签到功能

**测试页面**：签到页面

**前置条件**：已报名某个活动

**测试步骤**：
1. 进入活动详情页
2. 点击"签到"按钮
3. 允许获取位置权限
4. 提交签到

**预期结果**：
- ✅ 签到成功，显示"签到成功"
- ✅ 显示签到时间和位置
- ✅ 签到状态更新

**注意事项**：
- 位置验证可能会失败（距离活动地点太远）
- 可以临时修改后端签到范围限制进行测试

---

#### 📌 测试6：统计功能

**测试页面**：统计页面

**测试步骤**：
1. 进入统计页面
2. 查看我的统计数据
3. 如果是活动组织者，查看活动统计

**预期结果**：
- ✅ 统计数据正常显示
- ✅ 报名人数、签到人数等数据正确
- ✅ 图表正常渲染

---

### 第四步：错误场景测试

#### 场景1：网络错误

**测试方法**：
1. 停止后端服务
2. 尝试加载活动列表

**预期结果**：
- ✅ 显示友好的错误提示
- ✅ 提供重试按钮
- ✅ 控制台显示详细错误信息

#### 场景2：Token 过期

**测试方法**：
1. 清除本地存储的 token
2. 尝试访问需要登录的功能

**预期结果**：
- ✅ 自动跳转到登录页
- ✅ 提示"登录已过期"

#### 场景3：数据验证失败

**测试方法**：
1. 创建活动时填写无效数据（如：结束时间早于开始时间）
2. 提交表单

**预期结果**：
- ✅ 前端或后端进行验证
- ✅ 显示具体的错误提示
- ✅ 高亮错误字段

---

## 🐛 常见问题排查

### 问题1：网络请求失败 `request:fail url not in domain list`

**原因**：未禁用域名校验

**解决方案**：
1. 微信开发者工具 → 详情 → 本地设置
2. 勾选"不校验合法域名..."
3. 重新编译

---

### 问题2：数据显示异常（如：描述为空）

**原因**：字段名不匹配

**验证方法**：
1. 打开控制台查看网络请求
2. 查看响应数据结构
3. 检查是否包含 `description` 字段

**解决方案**：
- 数据适配器应该已经处理了 `description` → `desc` 的转换
- 如果仍然有问题，检查 `utils/data-adapter.js` 是否正确引入

---

### 问题3：日期格式显示错误

**原因**：日期格式未正确转换

**检查方法**：
1. 查看控制台日期值
2. 确认格式是否为 `'12月23日 19:00'`

**解决方案**：
- 检查数据适配器的 `formatDate` 函数
- 查看控制台是否有日期格式化错误

---

### 问题4：后端返回 500 错误

**原因**：后端逻辑错误或数据验证失败

**排查步骤**：
1. 查看后端控制台日志
2. 检查请求数据格式
3. 确认数据库连接正常

**常见错误**：
- 数据库字段不匹配
- 必填字段缺失
- 外键约束冲突

---

## 📊 测试记录模板

### 测试环境
- 前端环境：development
- 后端地址：http://localhost:8082
- 测试日期：____年__月__日
- 测试人员：________

### 测试结果

| 功能模块 | 测试项 | 状态 | 备注 |
|---------|--------|------|------|
| 活动管理 | 获取活动列表 | ☐通过 ☐失败 | |
| 活动管理 | 获取活动详情 | ☐通过 ☐失败 | |
| 活动管理 | 创建活动 | ☐通过 ☐失败 | |
| 活动管理 | 更新活动 | ☐通过 ☐失败 | |
| 活动管理 | 删除活动 | ☐通过 ☐失败 | |
| 报名管理 | 提交报名 | ☐通过 ☐失败 | |
| 报名管理 | 取消报名 | ☐通过 ☐失败 | |
| 报名管理 | 获取报名列表 | ☐通过 ☐失败 | |
| 签到管理 | 提交签到 | ☐通过 ☐失败 | |
| 签到管理 | 获取签到记录 | ☐通过 ☐失败 | |
| 统计功能 | 活动统计 | ☐通过 ☐失败 | |
| 统计功能 | 用户统计 | ☐通过 ☐失败 | |

### 发现的问题

| 序号 | 问题描述 | 严重程度 | 状态 |
|------|---------|---------|------|
| 1 | | ☐高 ☐中 ☐低 | ☐待修复 ☐已修复 |
| 2 | | ☐高 ☐中 ☐低 | ☐待修复 ☐已修复 |
| 3 | | ☐高 ☐中 ☐低 | ☐待修复 ☐已修复 |

---

## 📝 下一步

完成测试后：
1. 填写测试记录
2. 报告发现的问题
3. 根据问题优先级进行修复
4. 重新测试修复的功能
5. 生成最终测试报告
