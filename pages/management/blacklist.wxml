<!-- pages/management/blacklist.wxml -->
<view class="blacklist-page">
  <!-- 顶部标题栏 -->
  <view class="top-bar top-bar--fixed">
    <view class="top-bar__group">
      <view class="icon-btn" bindtap="goBack">
        <text>←</text>
      </view>
      <text class="text-lg" style="margin-left: 16rpx;">黑名单管理</text>
    </view>
    <view class="top-bar__group">
      <view class="badge badge--danger">{{blacklist.length}} 人</view>
    </view>
  </view>

  <!-- 提示信息 -->
  <view class="section" style="margin-top: 100rpx;">
    <view class="notice-card notice-card--warning">
      <text class="text-sm">黑名单中的用户将无法报名此活动,支持设置过期时间和手动启用/禁用</text>
    </view>
  </view>

  <!-- 黑名单列表 -->
  <view class="section">
    <text class="section-title">当前黑名单</text>

    <view wx:if="{{blacklist.length > 0}}" class="list">
      <block wx:for="{{blacklist}}" wx:key="phone">
        <view class="list-item card shadow-card">
          <view wx:if="{{item.avatar}}" class="list-avatar-container">
            <image src="{{item.avatar}}" mode="cover" class="list-avatar"></image>
          </view>
          <view wx:else class="list-avatar-container">
            <view class="list-avatar-placeholder">{{item.name.charAt(0)}}</view>
          </view>
          <view class="list-info">
            <text class="list-name">{{item.name}}</text>
            <text class="list-mobile">{{item.phone}}</text>
            <text wx:if="{{item.reason}}" class="list-reason">原因：{{item.reason}}</text>
          </view>
          <view class="list-status">
            <view class="status-badge status-badge--{{item.isExpired ? 'expired' : (item.isActive ? 'active' : 'disabled')}}">
              {{item.statusText}}
            </view>
          </view>
          <view class="list-actions">
            <view
              class="btn btn--small {{item.isActive ? 'btn--warning' : 'btn--secondary'}}"
              bindtap="toggleActive"
              data-phone="{{item.phone}}"
              data-name="{{item.name}}"
              data-is-active="{{item.isActive}}"
            >
              {{item.isActive ? '禁用' : '启用'}}
            </view>
            <view
              class="btn btn--danger btn--small"
              bindtap="removeItem"
              data-phone="{{item.phone}}"
              data-name="{{item.name}}"
              style="margin-left: 8rpx;"
            >
              移除
            </view>
          </view>
        </view>
      </block>
    </view>

    <view wx:else class="empty-state">
      <text class="empty-icon">🚫</text>
      <text class="empty-text">暂无黑名单</text>
      <text class="empty-hint">点击下方按钮添加</text>
    </view>
  </view>

  <!-- 底部添加按钮 -->
  <view class="fixed-footer">
    <view class="btn btn--primary" style="width: 100%;" bindtap="showAddDialog">
      添加黑名单
    </view>
  </view>

  <!-- 添加黑名单对话框 -->
  <view wx:if="{{showAddDialog}}" class="dialog-overlay" bindtap="closeAddDialog">
    <view class="dialog-content" catchtap="{{null}}">
      <view class="dialog-header">
        <text class="dialog-title">添加黑名单</text>
        <view class="dialog-close" bindtap="closeAddDialog">✕</view>
      </view>

      <view class="dialog-body">
        <view class="input-mode">
          <!-- 批量手机号输入 -->
          <view class="input-hint">
            <text class="text-sm text-gray-600">每行一个手机号，支持批量添加</text>
          </view>
          <textarea
            class="phone-textarea"
            placeholder="请输入手机号（每行一个）&#10;例如：&#10;13800138000&#10;13900139000"
            value="{{batchPhoneText}}"
            bindinput="onPhoneTextInput"
            maxlength="-1"
          ></textarea>

          <!-- 原因输入（可选）-->
          <view class="input-group" style="margin-top: 16rpx;">
            <text class="input-label">原因（可选）</text>
            <input
              class="input-field"
              placeholder="请输入拉黑原因（至少2个字）"
              value="{{blockReason}}"
              bindinput="onReasonInput"
              maxlength="100"
            />
          </view>

          <!-- 永久/临时切换 -->
          <view class="toggle-group">
            <view class="toggle-label">
              <text class="text-base">永久拉黑</text>
              <text class="text-sm text-gray-500">关闭后可设置过期时间</text>
            </view>
            <switch
              checked="{{isPermanent}}"
              bindchange="togglePermanent"
              color="#3b82f6"
            />
          </view>

          <!-- 过期天数（非永久时显示）-->
          <view wx:if="{{!isPermanent}}" class="input-group">
            <text class="input-label">过期天数（最少1天）</text>
            <input
              class="input-field"
              type="number"
              placeholder="请输入过期天数"
              value="{{expiryDays}}"
              bindinput="onExpiryDaysInput"
            />
          </view>
        </view>
      </view>

      <view class="dialog-footer">
        <view class="btn btn--secondary" bindtap="closeAddDialog">取消</view>
        <view class="btn btn--primary" bindtap="confirmAdd">确定</view>
      </view>
    </view>
  </view>

  <view class="bottom-space"></view>
</view>
