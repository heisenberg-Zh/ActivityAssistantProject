<!-- pages/management/registrations.wxml -->
<view class="registrations-page">
  <!-- é¡¶éƒ¨æ ‡é¢˜æ  -->
  <view class="top-bar top-bar--fixed" style="padding-top: {{statusBarHeight}}px;">
    <view class="top-bar__group">
      <view class="icon-btn icon-btn--back" bindtap="goBack">
        <text class="back-icon">â€¹</text>
      </view>
      <text class="text-lg" style="margin-left: 16rpx;">æŠ¥åç®¡ç†</text>
    </view>
    <view class="top-bar__group">
      <view class="badge badge--primary">{{allRegistrations.length}} äºº</view>
    </view>
  </view>

  <!-- çŠ¶æ€ç­›é€‰æ ‡ç­¾ -->
  <view class="filter-tabs">
    <view
      class="filter-tab {{statusFilter === 'all' ? 'filter-tab--active' : ''}}"
      bindtap="switchFilter"
      data-filter="all"
    >
      å…¨éƒ¨
    </view>
    <view
      class="filter-tab {{statusFilter === 'pending' ? 'filter-tab--active' : ''}}"
      bindtap="switchFilter"
      data-filter="pending"
    >
      å¾…å®¡æ ¸
    </view>
    <view
      class="filter-tab {{statusFilter === 'approved' ? 'filter-tab--active' : ''}}"
      bindtap="switchFilter"
      data-filter="approved"
    >
      å·²é€šè¿‡
    </view>
    <view
      class="filter-tab {{statusFilter === 'rejected' ? 'filter-tab--active' : ''}}"
      bindtap="switchFilter"
      data-filter="rejected"
    >
      å·²æ‹’ç»
    </view>
  </view>

  <!-- æŠ¥ååˆ—è¡¨ -->
  <view class="section">
    <view wx:if="{{displayRegistrations.length > 0}}" class="list">
      <block wx:for="{{displayRegistrations}}" wx:key="userId">
        <view class="list-item card shadow-card">
          <view wx:if="{{item.userAvatar}}" class="list-avatar-container">
            <image src="{{item.userAvatar}}" mode="cover" class="list-avatar"></image>
          </view>
          <view wx:else class="list-avatar-container">
            <view class="list-avatar-placeholder">{{item.userName.charAt(0)}}</view>
          </view>
          <view class="list-info">
            <text class="list-name">{{item.userName}}</text>
            <text class="list-mobile">{{item.mobile}}</text>
            <text class="list-time">æŠ¥åæ—¶é—´ï¼š{{item.registeredAt}}</text>
          </view>
          <view class="list-status">
            <view class="status-badge status-badge--{{item.statusColor}}">
              {{item.statusText}}
            </view>
          </view>
          <view class="list-actions">
            <!-- å¾…å®¡æ ¸çŠ¶æ€æ˜¾ç¤ºå®¡æ ¸æŒ‰é’® -->
            <block wx:if="{{item.status === 'pending'}}">
              <view
                class="btn btn--success btn--small"
                bindtap="approveRegistration"
                data-user-id="{{item.userId}}"
                data-name="{{item.userName}}"
              >
                é€šè¿‡
              </view>
              <view
                class="btn btn--danger btn--small"
                bindtap="rejectRegistration"
                data-user-id="{{item.userId}}"
                data-name="{{item.userName}}"
                style="margin-left: 8rpx;"
              >
                æ‹’ç»
              </view>
            </block>
            <!-- æ‰€æœ‰çŠ¶æ€éƒ½æ˜¾ç¤ºç§»é™¤æŒ‰é’® -->
            <view
              class="btn btn--secondary btn--small"
              bindtap="showRemoveDialog"
              data-user-id="{{item.userId}}"
              data-name="{{item.userName}}"
              data-mobile="{{item.mobile}}"
              style="margin-left: 8rpx;"
            >
              ç§»é™¤
            </view>
          </view>
        </view>
      </block>
    </view>

    <view wx:else class="empty-state">
      <text class="empty-icon">ğŸ“‹</text>
      <text class="empty-text">æš‚æ— æŠ¥åè®°å½•</text>
      <text class="empty-hint">å½“å‰ç­›é€‰æ¡ä»¶ä¸‹æ²¡æœ‰æ•°æ®</text>
    </view>
  </view>

  <!-- ç§»é™¤æŠ¥åå¯¹è¯æ¡† -->
  <view wx:if="{{showRemoveDialog}}" class="dialog-overlay" bindtap="closeRemoveDialog">
    <view class="dialog-content" catchtap="{{null}}">
      <view class="dialog-header">
        <text class="dialog-title">ç§»é™¤æŠ¥å</text>
        <view class="dialog-close" bindtap="closeRemoveDialog">âœ•</view>
      </view>

      <view class="dialog-body">
        <view class="remove-mode">
          <!-- æç¤ºä¿¡æ¯ -->
          <view class="remove-hint">
            <text class="text-base">ç¡®å®šè¦ç§»é™¤ä»¥ä¸‹ç”¨æˆ·çš„æŠ¥åå—ï¼Ÿ</text>
            <view class="user-info-card">
              <text class="text-sm text-gray-600">å§“åï¼š{{removeTarget.name}}</text>
              <text class="text-sm text-gray-600">æ‰‹æœºï¼š{{removeTarget.mobile}}</text>
            </view>
          </view>

          <!-- åŠ å…¥é»‘åå•é€‰é¡¹ -->
          <view class="toggle-group">
            <view class="toggle-label">
              <text class="text-base">åŒæ—¶åŠ å…¥é»‘åå•</text>
              <text class="text-sm text-gray-500">è¯¥ç”¨æˆ·å°†æ— æ³•å†æ¬¡æŠ¥å</text>
            </view>
            <switch
              checked="{{addToBlacklist}}"
              bindchange="toggleBlacklist"
              color="#3b82f6"
            />
          </view>

          <!-- åŸå› è¾“å…¥ï¼ˆåŠ å…¥é»‘åå•æ—¶å¿…å¡«ï¼‰-->
          <view wx:if="{{addToBlacklist}}" class="input-group">
            <text class="input-label">åŸå› ï¼ˆå¿…å¡«ï¼Œè‡³å°‘2ä¸ªå­—ï¼‰</text>
            <textarea
              class="reason-textarea"
              placeholder="è¯·è¾“å…¥ç§»é™¤åŸå› "
              value="{{removeReason}}"
              bindinput="onReasonInput"
              maxlength="200"
            ></textarea>
          </view>
        </view>
      </view>

      <view class="dialog-footer">
        <view class="btn btn--secondary" bindtap="closeRemoveDialog">å–æ¶ˆ</view>
        <view class="btn btn--danger" bindtap="confirmRemove">ç¡®å®šç§»é™¤</view>
      </view>
    </view>
  </view>

  <view class="bottom-space"></view>
</view>
