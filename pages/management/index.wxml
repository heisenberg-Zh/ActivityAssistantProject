<!-- pages/management/index.wxml -->
<view class="management-page">
  <!-- é¡¶éƒ¨æ ‡é¢˜æ  -->
  <view class="top-bar top-bar--fixed" style="padding-top: {{statusBarHeight}}px;">
    <view class="top-bar__group">
      <view class="icon-btn icon-btn--back" bindtap="goBack">
        <text class="back-icon">â€¹</text>
      </view>
      <text class="text-lg" style="margin-left: 16rpx;">æ´»åŠ¨ç®¡ç†</text>
    </view>
  </view>

  <!-- æ»šåŠ¨å®¹å™¨ -->
  <scroll-view
    class="page-scroll"
    scroll-y
    scroll-top="0"
    upper-threshold="0"
    enable-back-to-top
    enhanced
    show-scrollbar="{{false}}"
    style="top: {{navBarHeight}}px; bottom: 0;"
  >
    <!-- æ´»åŠ¨æ¦‚è§ˆå¡ç‰‡ - å…¨æ–°è®¾è®¡ -->
    <view class="activity-overview">
    <view class="overview-card">
      <!-- é¡¶éƒ¨ä¿¡æ¯æ  -->
      <view class="overview-header">
        <view class="overview-title-row">
          <text class="overview-title">{{activity.title}}</text>
          <view class="status-badge status-badge--{{activity.status === 'è¿›è¡Œä¸­' ? 'active' : (activity.status === 'å³å°†å¼€å§‹' ? 'upcoming' : 'ended')}}">
            {{activity.status}}
          </view>
        </view>
        <view class="overview-role">
          <text class="role-icon">{{role === 'creator' ? 'ğŸ‘‘' : 'â­'}}</text>
          <text class="role-label">{{role === 'creator' ? 'åˆ›å»ºè€…' : 'ç®¡ç†å‘˜'}}</text>
        </view>
      </view>

      <!-- æ•°æ®ç»Ÿè®¡å¡ç‰‡ç»„ -->
      <view class="stats-cards">
        <view class="stat-card stat-card--primary" bindtap="openUserListModal" data-type="total">
          <view class="stat-card-icon">ğŸ‘¥</view>
          <view class="stat-card-info">
            <text class="stat-card-value">{{totalRegistrations}}</text>
            <text class="stat-card-label">æ€»æŠ¥å</text>
          </view>
        </view>

        <view class="stat-card stat-card--success" bindtap="openUserListModal" data-type="approved">
          <view class="stat-card-icon">âœ“</view>
          <view class="stat-card-info">
            <text class="stat-card-value">{{approvedCount}}</text>
            <text class="stat-card-label">å·²é€šè¿‡</text>
          </view>
        </view>

        <view class="stat-card stat-card--warning" bindtap="openUserListModal" data-type="pending">
          <view class="stat-card-icon">â³</view>
          <view class="stat-card-info">
            <text class="stat-card-value">{{pendingCount}}</text>
            <text class="stat-card-label">å¾…å®¡æ ¸</text>
          </view>
          <!-- å¾…å®¡æ ¸è§’æ ‡ -->
          <view wx:if="{{pendingCount > 0}}" class="stat-badge">{{pendingCount}}</view>
        </view>

        <view class="stat-card stat-card--info" bindtap="openUserListModal" data-type="administrators">
          <view class="stat-card-icon">ğŸ›¡ï¸</view>
          <view class="stat-card-info">
            <text class="stat-card-value">{{administrators.length}}</text>
            <text class="stat-card-label">ç®¡ç†å‘˜</text>
          </view>
        </view>
      </view>

      <!-- è¯„ä»·ç»Ÿè®¡è¡Œï¼ˆä»…å·²ç»“æŸæ´»åŠ¨æ˜¾ç¤ºï¼‰ -->
      <view wx:if="{{activity.status === 'å·²ç»“æŸ' && reviewStatistics}}" class="review-stats-section">
        <view class="review-stats-row">
          <view class="review-left">
            <text class="review-icon">â­</text>
            <text class="review-title">æ´»åŠ¨è¯„ä»·</text>
          </view>
          <view class="review-right">
            <text class="review-rating-text">{{reviewStatistics.averageRating || 0}}</text>
            <text class="review-suffix-text">/5.0</text>
            <text class="review-divider-text">Â·</text>
            <text class="review-count-text">{{reviewStatistics.totalReviews || 0}}æ¡è¯„ä»·</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- ç®¡ç†åŠŸèƒ½ç½‘æ ¼ - å…¨æ–°è®¾è®¡ -->
  <view class="management-grid">
    <view class="grid-header">
      <text class="grid-title">ç®¡ç†åŠŸèƒ½</text>
    </view>

    <view class="function-grid">
      <block wx:for="{{menuItems}}" wx:key="id">
        <!-- å¦‚æœæ˜¯ä»…åˆ›å»ºè€…åŠŸèƒ½ä¸”å½“å‰ç”¨æˆ·ä¸æ˜¯åˆ›å»ºè€…ï¼Œåˆ™ä¸æ˜¾ç¤º -->
        <view
          wx:if="{{!item.creatorOnly || role === 'creator'}}"
          class="function-item"
          bindtap="onMenuItemTap"
          data-id="{{item.id}}"
          data-path="{{item.path}}"
          data-creator-only="{{item.creatorOnly}}"
          data-available-when="{{item.availableWhen}}"
        >
          <view class="function-icon-wrapper">
            <text class="function-icon">{{item.icon}}</text>
          </view>
          <text class="function-name">{{item.title}}</text>
          <!-- ä»…åˆ›å»ºè€…å¯è§çš„æ ‡è¯† -->
          <view wx:if="{{item.creatorOnly}}" class="creator-only-badge">
            <text class="creator-badge-text">åˆ›å»ºè€…</text>
          </view>
        </view>
      </block>
    </view>
  </view>

    <view class="bottom-space"></view>
  </scroll-view>

  <!-- äººå‘˜åˆ—è¡¨å¼¹çª— -->
  <view wx:if="{{showUserListModal}}" class="modal-overlay" bindtap="closeUserListModal">
    <view class="modal-content" catchtap>
      <view class="modal-header">
        <text class="modal-title">{{modalTitle}}</text>
        <view class="modal-close" bindtap="closeUserListModal">âœ•</view>
      </view>

      <scroll-view class="modal-body" scroll-y>
        <view wx:if="{{userList.length === 0}}" class="empty-state">
          <text class="empty-icon">ğŸ“­</text>
          <text class="empty-text">æš‚æ— æ•°æ®</text>
        </view>

        <view wx:else class="user-list">
          <view wx:for="{{userList}}" wx:key="id" class="user-item">
            <view class="user-info">
              <text class="user-name">{{item.name}}</text>
              <text class="user-id">ID: {{item.id}}</text>
            </view>
            <view wx:if="{{item.role}}" class="user-role-tag">{{item.role}}</view>
            <view wx:if="{{item.status}}" class="user-status-tag user-status-{{item.status}}">
              {{item.status === 'approved' ? 'å·²é€šè¿‡' : item.status === 'pending' ? 'å¾…å®¡æ ¸' : 'å·²æ‹’ç»'}}
            </view>
          </view>
        </view>
      </scroll-view>

      <view class="modal-footer">
        <button class="modal-btn" bindtap="closeUserListModal">å…³é—­</button>
      </view>
    </view>
  </view>
</view>
