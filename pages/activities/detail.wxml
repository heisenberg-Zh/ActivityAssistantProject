<!-- pages/activities/detail.wxml -->
<view class="detail-header">
  <text class="detail-title">{{detail.title}}</text>
</view>

<view class="detail-cover banner banner--{{detail.banner}}">
  <view class="cover-status">{{detail.status}}</view>
  <view class="cover-type">{{detail.type}}</view>
</view>

<view class="section">
  <view class="card shadow-card detail-card">
    <text class="text-sm text-gray-500 mb-16">{{detail.desc}}</text>

    <view class="organizer">
      <view class="organizer-avatar">{{extra.organizerInitial}}</view>
      <view class="flex-col">
        <text class="text-md text-gray-800">{{extra.organizer}}</text>
        <text class="text-xs text-gray-500">æ´»åŠ¨ç»„ç»‡è€…</text>
      </view>
    </view>

    <view class="info-list">
      <view class="info-item">
        <view class="info-item__icon" style="background:#DBEAFE; color:#1d4ed8;">ğŸ•</view>
        <view class="flex-col info-item__body">
          <text class="info-label">æ´»åŠ¨æ—¶é—´</text>
          <text class="info-value">{{detail.timeRange}}</text>
          <text class="info-hint">æŠ¥åæˆªæ­¢ï¼š{{extra.deadline}}</text>
        </view>
      </view>
      <view class="info-item">
        <view class="info-item__icon" style="background:#DCFCE7; color:#047857;">ğŸ“</view>
        <view class="flex-col info-item__body">
          <text class="info-label">æ´»åŠ¨åœ°ç‚¹</text>
          <text class="info-value">{{detail.place}}</text>
          <text class="info-hint">{{extra.addressDetail}}</text>
        </view>
      </view>
      <view class="info-item">
        <view class="info-item__icon" style="background:#FDE68A; color:#B45309;">ğŸ‘¥</view>
        <view class="flex-col info-item__body">
          <text class="info-label">å‚ä¸äººæ•°</text>
          <text class="info-value">{{detail.joined}} / {{detail.total}} äºº</text>
          <view class="progress mt-12"><view class="bar" style="width: {{progress}}%"></view></view>
        </view>
      </view>
      <view class="info-item">
        <view class="info-item__icon" style="background:#FEF3C7; color:#D97706;">ğŸ”–</view>
        <view class="flex-col info-item__body">
          <text class="info-label">æ´»åŠ¨ç¼–å·</text>
          <text class="info-value">{{detail.id}}</text>
          <text class="info-hint">æ´»åŠ¨å”¯ä¸€æ ‡è¯†</text>
        </view>
      </view>
    </view>
  </view>
</view>

<!-- åˆ†ç»„ä¿¡æ¯ -->
<view class="section" wx:if="{{detail.hasGroups && detail.groups && detail.groups.length > 0}}">
  <view class="card shadow-card">
    <text class="text-lg text-gray-800 mb-16" style="display: block; font-weight: 600;">æ´»åŠ¨åˆ†ç»„</text>

    <!-- åˆ†ç»„Tab -->
    <view class="group-tabs-detail">
      <block wx:for="{{detail.groups}}" wx:key="id" wx:for-item="group" wx:for-index="idx">
        <view class="group-tab-detail {{currentGroupIndex === idx ? 'group-tab-detail--active' : ''}}" bindtap="switchGroup" data-index="{{idx}}">
          <text class="group-tab-detail__name">{{group.name}}</text>
          <text class="group-tab-detail__count">{{group.joined}}/{{group.total}}</text>
        </view>
      </block>
    </view>

    <!-- å½“å‰åˆ†ç»„è¯¦æƒ… -->
    <view wx:if="{{detail.groups[currentGroupIndex]}}" class="group-detail-content">
      <view class="info-item" style="margin-top: 24rpx;">
        <view class="info-item__icon" style="background:#E0E7FF; color:#4338CA;">ğŸ’°</view>
        <view class="flex-col info-item__body">
          <text class="info-label">è´¹ç”¨</text>
          <text class="info-value">{{detail.groups[currentGroupIndex].feeType}} {{detail.groups[currentGroupIndex].feeType !== 'å…è´¹' ? 'Â¥' + detail.groups[currentGroupIndex].fee : ''}}</text>
        </view>
      </view>

      <view wx:if="{{detail.groups[currentGroupIndex].requirements}}" style="margin-top: 24rpx; padding: 20rpx; background: #fffbeb; border-radius: 12rpx; border-left: 4rpx solid #f59e0b;">
        <text class="text-sm text-gray-700" style="display: block; font-weight: 600; margin-bottom: 8rpx;">âš ï¸ æŠ¥åè¦æ±‚</text>
        <text class="text-sm text-gray-600">{{detail.groups[currentGroupIndex].requirements}}</text>
      </view>

      <view wx:if="{{detail.groups[currentGroupIndex].description}}" style="margin-top: 16rpx; padding: 20rpx; background: #eff6ff; border-radius: 12rpx; border-left: 4rpx solid #3b82f6;">
        <text class="text-sm text-gray-700" style="display: block; font-weight: 600; margin-bottom: 8rpx;">ğŸ“ æ´»åŠ¨è¯´æ˜</text>
        <text class="text-sm text-gray-600">{{detail.groups[currentGroupIndex].description}}</text>
      </view>
    </view>
  </view>
</view>

<!-- æ— åˆ†ç»„æ—¶çš„è´¹ç”¨å’Œè¯´æ˜ä¿¡æ¯ -->
<view class="section" wx:if="{{!detail.hasGroups}}">
  <view class="card shadow-card">
    <view class="info-item">
      <view class="info-item__icon" style="background:#E0E7FF; color:#4338CA;">ğŸ’°</view>
      <view class="flex-col info-item__body">
        <text class="info-label">æ´»åŠ¨è´¹ç”¨</text>
        <text class="info-value">{{extra.feeInfo}}</text>
      </view>
    </view>

    <view wx:if="{{detail.requirements}}" style="margin-top: 24rpx; padding: 20rpx; background: #fffbeb; border-radius: 12rpx; border-left: 4rpx solid #f59e0b;">
      <text class="text-sm text-gray-700" style="display: block; font-weight: 600; margin-bottom: 8rpx;">âš ï¸ æŠ¥åè¦æ±‚</text>
      <text class="text-sm text-gray-600">{{detail.requirements}}</text>
    </view>

    <view wx:if="{{detail.description}}" style="margin-top: 16rpx; padding: 20rpx; background: #eff6ff; border-radius: 12rpx; border-left: 4rpx solid #3b82f6;">
      <text class="text-sm text-gray-700" style="display: block; font-weight: 600; margin-bottom: 8rpx;">ğŸ“ æ´»åŠ¨è¯´æ˜</text>
      <text class="text-sm text-gray-600">{{detail.description}}</text>
    </view>
  </view>
</view>

<view class="section">
  <view class="card shadow-card participants-card">
    <view class="row-between mb-16">
      <text class="text-lg text-gray-800">å‚ä¸æˆå‘˜ ({{members.length}})</text>
      <view class="text-sm text-blue-500" bindtap="viewAllMembers" hover-class="none">æŸ¥çœ‹å…¨éƒ¨</view>
    </view>
    <view class="participants-grid">
      <block wx:for="{{members}}" wx:key="id" wx:for-item="item">
        <view class="participants-item">
          <image src="{{item.avatar}}" mode="cover" class="participants-avatar" />
          <text class="text-xs text-gray-600">{{item.name}}</text>
        </view>
      </block>
    </view>
  </view>
</view>

<view class="bottom-space"></view>
<view class="fixed-footer">
  <button class="btn btn--secondary footer-btn" bindtap="onShare">åˆ†äº«</button>
  <button class="btn {{isRegistered ? 'btn--danger' : 'btn--primary'}} footer-btn" bindtap="{{isRegistered ? 'cancelRegistration' : 'goRegister'}}">{{isRegistered ? 'å–æ¶ˆæŠ¥å' : 'æŠ¥å'}}</button>
</view>