<!-- pages/checkin/index.wxml -->
<view class="page-container">
  <!-- æ´»åŠ¨ä¿¡æ¯å¡ç‰‡ -->
  <view class="section">
    <view class="activity-header-card">
      <view class="activity-title-row">
        <text class="activity-title">{{activity.title}}</text>
        <view class="activity-status-badge {{activityStatusClass}}">{{activity.status}}</view>
      </view>
      <view class="activity-info-grid">
        <view class="info-item">
          <text class="info-icon">ğŸ“…</text>
          <text class="info-text">{{activity.timeRange}}</text>
        </view>
        <view class="info-item">
          <text class="info-icon">ğŸ“</text>
          <text class="info-text">{{activity.place}}</text>
        </view>
        <view class="info-item">
          <text class="info-icon">ğŸ‘¥</text>
          <text class="info-text">{{activity.joined}}/{{activity.total}}äºº</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç­¾åˆ°çŠ¶æ€åŒºåŸŸ -->
  <view class="section">
    <view class="checkin-status-card {{checked ? 'status-checked' : 'status-unchecked'}}">
      <view class="status-visual">
        <view class="status-circle {{checked ? 'circle-success' : 'circle-pending'}}">
          <text class="status-icon-text">{{checked ? 'âœ“' : 'â±'}}</text>
        </view>
        <view class="status-ripple {{checked ? 'ripple-success' : 'ripple-pending'}}"></view>
      </view>
      <text class="status-title">{{checked ? 'ç­¾åˆ°æˆåŠŸ' : 'ç­‰å¾…ç­¾åˆ°'}}</text>
      <text class="status-desc">{{checked ? 'æ‚¨å·²æˆåŠŸç­¾åˆ°æœ¬æ¬¡æ´»åŠ¨' : 'è¯·åœ¨æ´»åŠ¨åœ°ç‚¹èŒƒå›´å†…å®Œæˆç­¾åˆ°'}}</text>

      <block wx:if="{{checked}}">
        <view class="checkin-time-badge">
          <text class="badge-icon">ğŸ•</text>
          <text class="badge-text">{{checkTime}}</text>
        </view>
      </block>
      <block wx:else>
        <button class="checkin-action-btn" bindtap="doCheckin">
          <text class="btn-text">ç«‹å³ç­¾åˆ°</text>
        </button>
      </block>
    </view>
  </view>

  <!-- ä½ç½®ä¿¡æ¯åŒºåŸŸ -->
  <view class="section">
    <view class="location-info-card">
      <view class="location-header">
        <text class="location-title">ä½ç½®éªŒè¯</text>
        <view class="location-status {{withinRange ? 'location-valid' : 'location-invalid'}}">
          <text class="status-dot"></text>
          <text class="status-text">{{withinRange ? 'ç¬¦åˆè¦æ±‚' : 'è¶…å‡ºèŒƒå›´'}}</text>
        </view>
      </view>

      <view class="location-visual">
        <view class="location-target">
          <view class="target-icon">ğŸ¯</view>
          <view class="target-info">
            <text class="target-label">ç­¾åˆ°åœ°ç‚¹</text>
            <text class="target-value">{{activity.place}}</text>
          </view>
        </view>

        <view class="location-distance">
          <view class="distance-line {{withinRange ? 'line-valid' : 'line-invalid'}}">
            <view class="distance-dot dot-start"></view>
            <view class="distance-dot dot-end"></view>
          </view>
          <text class="distance-text">{{withinRange ? 'èŒƒå›´å†…' : 'è¯·é è¿‘'}}</text>
        </view>

        <view class="location-current">
          <view class="current-icon">ğŸ“</view>
          <view class="current-info">
            <text class="current-label">å½“å‰ä½ç½®</text>
            <text class="current-value">{{currentAddr || 'è·å–ä¸­...'}}</text>
          </view>
        </view>
      </view>

      <button class="location-refresh-btn" bindtap="refreshLocation">
        <text class="refresh-icon">ğŸ”„</text>
        <text class="refresh-text">åˆ·æ–°ä½ç½®</text>
      </button>
    </view>
  </view>

  <!-- ç­¾åˆ°è®°å½•åŒºåŸŸ -->
  <view class="section">
    <view class="records-card">
      <view class="records-header">
        <view class="records-title-row">
          <text class="records-title">ç­¾åˆ°è®°å½•</text>
          <view class="records-count-badge">{{checkedCount}}/{{records.length}}</view>
        </view>
        <view class="records-progress-bar">
          <view class="progress-fill" style="width: {{progress}}%"></view>
        </view>
      </view>

      <view class="records-list">
        <block wx:for="{{records}}" wx:key="id" wx:for-item="item" wx:for-index="idx">
          <view class="record-item">
            <view class="record-left">
              <image src="{{item.avatar}}" class="record-avatar" mode="cover" />
              <view class="record-user-info">
                <view class="record-name-row">
                  <text class="record-name">{{item.name}}</text>
                  <text wx:if="{{item.role}}" class="record-role-tag">{{item.role}}</text>
                </view>
                <text wx:if="{{item.time}}" class="record-time">{{item.time}}</text>
              </view>
            </view>
            <view class="record-status {{item.checked ? 'status-done' : 'status-waiting'}}">
              <text class="status-badge-text">{{item.checked ? 'âœ“ å·²ç­¾åˆ°' : 'å¾…ç­¾åˆ°'}}</text>
            </view>
          </view>
        </block>
      </view>
    </view>
  </view>

  <view class="bottom-safe-area"></view>
</view>
