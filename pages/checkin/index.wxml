<!-- pages/checkin/index.wxml -->
<view class="page-container">
  <!-- 活动信息卡片 -->
  <view class="section">
    <view class="activity-header-card">
      <view class="activity-title-row">
        <text class="activity-title">{{activity.title}}</text>
        <view class="activity-status-badge {{activityStatusClass}}">{{activity.status}}</view>
      </view>
      <view class="activity-info-grid">
        <view class="info-item">
          <text class="info-icon">📅</text>
          <text class="info-text">{{activity.timeRange}}</text>
        </view>
        <view class="info-item">
          <text class="info-icon">📍</text>
          <text class="info-text">{{activity.place}}</text>
        </view>
        <view class="info-item">
          <text class="info-icon">👥</text>
          <text class="info-text">{{activity.joined}}/{{activity.total}}人</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 签到状态区域 -->
  <view class="section">
    <view class="checkin-status-card {{checked ? 'status-checked' : 'status-unchecked'}}">
      <view class="status-visual">
        <view class="status-circle {{checked ? 'circle-success' : 'circle-pending'}}">
          <text class="status-icon-text">{{checked ? '✓' : '⏱'}}</text>
        </view>
        <view class="status-ripple {{checked ? 'ripple-success' : 'ripple-pending'}}"></view>
      </view>
      <text class="status-title">{{checked ? '签到成功' : '等待签到'}}</text>
      <text class="status-desc">{{checked ? '您已成功签到本次活动' : '请在活动地点范围内完成签到'}}</text>

      <block wx:if="{{checked}}">
        <view class="checkin-time-badge">
          <text class="badge-icon">🕐</text>
          <text class="badge-text">{{checkTime}}</text>
        </view>
      </block>
      <block wx:else>
        <button class="checkin-action-btn" bindtap="doCheckin">
          <text class="btn-text">立即签到</text>
        </button>
      </block>
    </view>
  </view>

  <!-- 位置信息区域 -->
  <view class="section">
    <view class="location-info-card">
      <view class="location-header">
        <text class="location-title">位置验证</text>
        <view class="location-status {{withinRange ? 'location-valid' : 'location-invalid'}}">
          <text class="status-dot"></text>
          <text class="status-text">{{withinRange ? '符合要求' : '超出范围'}}</text>
        </view>
      </view>

      <view class="location-visual">
        <view class="location-target">
          <view class="target-icon">🎯</view>
          <view class="target-info">
            <text class="target-label">签到地点</text>
            <text class="target-value">{{activity.place}}</text>
          </view>
        </view>

        <view class="location-distance">
          <view class="distance-line {{withinRange ? 'line-valid' : 'line-invalid'}}">
            <view class="distance-dot dot-start"></view>
            <view class="distance-dot dot-end"></view>
          </view>
          <text class="distance-text">{{withinRange ? '范围内' : '请靠近'}}</text>
        </view>

        <view class="location-current">
          <view class="current-icon">📍</view>
          <view class="current-info">
            <text class="current-label">当前位置</text>
            <text class="current-value">{{currentAddr || '获取中...'}}</text>
          </view>
        </view>
      </view>

      <button class="location-refresh-btn" bindtap="refreshLocation">
        <text class="refresh-icon">🔄</text>
        <text class="refresh-text">刷新位置</text>
      </button>
    </view>
  </view>

  <!-- 签到记录区域 -->
  <view class="section">
    <view class="records-card">
      <view class="records-header">
        <view class="records-title-row">
          <text class="records-title">签到记录</text>
          <view class="records-count-badge">{{checkedCount}}/{{records.length}}</view>
        </view>
        <view class="records-progress-bar">
          <view class="progress-fill" style="width: {{progress}}%"></view>
        </view>
      </view>

      <view class="records-list">
        <block wx:for="{{records}}" wx:key="id" wx:for-item="item" wx:for-index="idx">
          <view class="record-item">
            <view class="record-left">
              <image src="{{item.avatar}}" class="record-avatar" mode="cover" />
              <view class="record-user-info">
                <view class="record-name-row">
                  <text class="record-name">{{item.name}}</text>
                  <text wx:if="{{item.role}}" class="record-role-tag">{{item.role}}</text>
                </view>
                <text wx:if="{{item.time}}" class="record-time">{{item.time}}</text>
              </view>
            </view>
            <view class="record-status {{item.checked ? 'status-done' : 'status-waiting'}}">
              <text class="status-badge-text">{{item.checked ? '✓ 已签到' : '待签到'}}</text>
            </view>
          </view>
        </block>
      </view>
    </view>
  </view>

  <view class="bottom-safe-area"></view>
</view>

<!-- 底部操作栏 -->
<view class="fixed-bottom-bar">
  <button class="bottom-action-btn btn-secondary" bindtap="share">
    <text class="btn-icon">📤</text>
    <text class="btn-label">分享</text>
  </button>
  <navigator class="bottom-action-btn btn-primary" hover-class="none" url="/pages/statistics/index">
    <text class="btn-icon">📊</text>
    <text class="btn-label">查看统计</text>
  </navigator>
</view>
