<!-- pages/my-activities/index.wxml -->

<!-- æ¸¸å®¢çŠ¶æ€æç¤º -->
<view wx:if="{{!isLoggedIn}}" class="guest-container">
  <view class="guest-content">
    <view class="guest-icon">ğŸ“</view>
    <text class="guest-title">æˆ‘çš„æ´»åŠ¨</text>
    <text class="guest-desc">ç™»å½•åæŸ¥çœ‹å’Œç®¡ç†æ‚¨çš„æ´»åŠ¨</text>
    <view class="guest-features">
      <view class="guest-feature-item">
        <text class="guest-feature-icon">ğŸ“…</text>
        <text class="guest-feature-text">æŸ¥çœ‹æˆ‘åˆ›å»ºçš„æ´»åŠ¨</text>
      </view>
      <view class="guest-feature-item">
        <text class="guest-feature-icon">ğŸ‘¥</text>
        <text class="guest-feature-text">æŸ¥çœ‹æˆ‘å‚åŠ çš„æ´»åŠ¨</text>
      </view>
      <view class="guest-feature-item">
        <text class="guest-feature-icon">ğŸ“‹</text>
        <text class="guest-feature-text">ç®¡ç†æ´»åŠ¨è‰ç¨¿</text>
      </view>
    </view>
    <view class="guest-login-btn" bindtap="goLogin">
      <text class="guest-login-icon">ğŸ”</text>
      <text class="guest-login-text">ç«‹å³ç™»å½•</text>
    </view>
  </view>
</view>

<!-- å·²ç™»å½•çŠ¶æ€æ˜¾ç¤ºæ´»åŠ¨åˆ—è¡¨ -->
<view wx:else class="page-container">
  <view class="filter-section">
    <scroll-view scroll-x class="filter-scroll-view" show-scrollbar="false">
      <view class="filter-tabs">
        <block wx:for="{{filters}}" wx:key="key" wx:for-item="item">
          <view class="filter-tab {{item.active ? 'filter-tab--active' : ''}}" bindtap="onFilterTap" data-key="{{item.key}}">
            {{item.name}}
          </view>
        </block>
      </view>
    </scroll-view>
  </view>

  <view class="content-section">
    <block wx:for="{{display}}" wx:key="displayId" wx:for-item="item">
      <view class="card shadow-card my-card">
        <view class="row-between my-card__header">
          <view class="row gap-12">
            <view class="badge badge--dark">{{item.role}}</view>
            <view class="badge {{ item.status === 'è¿›è¡Œä¸­' ? 'badge--ok' : (item.status === 'å³å°†å¼€å§‹' ? 'badge--info' : 'badge--muted') }}">{{item.status}}</view>
          </view>
          <view class="badge badge--light">{{item.type}}</view>
        </view>
        <view class="my-card__body">
          <text class="text-lg text-gray-800 mb-12">{{item.title}}</text>

          <!-- æ´»åŠ¨ç¼–å· -->
          <view class="activity-id-row mb-12">
            <text class="activity-id-label">æ´»åŠ¨ç¼–å·</text>
            <text class="activity-id-value">{{item.displayId || item.id}}</text>
          </view>

          <!-- æ´»åŠ¨ä¿¡æ¯ç½‘æ ¼ -->
          <view class="info-grid-row mb-12">
            <view class="info-col">
              <text class="info-label">æ—¶é—´</text>
              <text class="info-value">{{item.timeRange}}</text>
            </view>
            <view class="info-col">
              <text class="info-label">åœ°ç‚¹</text>
              <text class="info-value">{{item.place}}</text>
            </view>
          </view>

          <!-- åº•éƒ¨æ“ä½œæ  -->
          <view class="row-between">
            <text class="text-sm text-gray-600">æŠ¥åï¼š{{item.joined}} / {{item.total}}</text>
            <view class="row gap-12">
              <block wx:for="{{item.actions}}" wx:key="label" wx:for-item="action">
                <view class="btn {{action.type === 'primary' ? 'btn--primary' : (action.type === 'danger' ? 'btn--danger' : 'btn--secondary')}} btn--small" catchtap="handleAction" data-action="{{action.action}}" data-id="{{item.id}}">{{action.label}}</view>
              </block>
            </view>
          </view>
        </view>
      </view>
    </block>
  </view>

  <view class="bottom-space"></view>
</view>

<!-- è¯„ä»·å¼¹çª— -->
<view class="review-modal {{showReviewModal ? 'review-modal--show' : ''}}" catchtap="closeReviewModal">
  <view class="review-modal__content" catchtap="preventClose">
    <!-- å¼¹çª—å¤´éƒ¨ -->
    <view class="review-modal__header">
      <text class="review-modal__title">æ´»åŠ¨è¯„ä»·</text>
      <view class="review-modal__close" catchtap="closeReviewModal">
        <text class="review-modal__close-icon">âœ•</text>
      </view>
    </view>

    <!-- æ´»åŠ¨åç§° -->
    <view class="review-modal__activity">
      <text class="review-modal__activity-label">æ´»åŠ¨åç§°</text>
      <text class="review-modal__activity-name">{{currentActivityTitle}}</text>
    </view>

    <!-- æ˜Ÿçº§è¯„åˆ† -->
    <view class="review-modal__rating-section">
      <text class="review-modal__section-title">æ»¡æ„åº¦è¯„åˆ†</text>
      <view class="review-stars">
        <block wx:for="{{[1,2,3,4,5]}}" wx:key="*this">
          <view
            class="star-item"
            data-star="{{item}}"
            bindtap="onStarTap"
            bindtouchstart="onStarTouchStart"
            bindtouchend="onStarTouchEnd"
          >
            <text class="star-icon {{(hoverRating > 0 ? hoverRating : rating) >= item ? 'star-filled' : 'star-empty'}}">â˜…</text>
          </view>
        </block>
      </view>
      <text class="review-rating-text">
        {{rating === 0 ? 'è¯·ç‚¹å‡»æ˜Ÿæ˜Ÿæ‰“åˆ†' : (rating === 5 ? 'éå¸¸æ»¡æ„' : (rating === 4 ? 'æ¯”è¾ƒæ»¡æ„' : (rating === 3 ? 'ä¸€èˆ¬' : (rating === 2 ? 'ä¸å¤ªæ»¡æ„' : 'å¾ˆä¸æ»¡æ„'))))}}
      </text>
    </view>

    <!-- æ–‡å­—è¯„ä»· -->
    <view class="review-modal__text-section">
      <text class="review-modal__section-title">æ„è§å’Œå»ºè®®ï¼ˆé€‰å¡«ï¼‰</text>
      <textarea
        class="review-textarea"
        placeholder="è¯·åˆ†äº«æ‚¨å¯¹æœ¬æ¬¡æ´»åŠ¨çš„æ„Ÿå—å’Œå»ºè®®..."
        maxlength="500"
        value="{{reviewText}}"
        bindinput="onReviewInput"
        placeholder-class="review-textarea-placeholder"
      />
      <view class="review-textarea-counter">
        <text class="counter-text">{{reviewText.length}}/500</text>
      </view>
    </view>

    <!-- æäº¤æŒ‰é’® -->
    <view class="review-modal__actions">
      <button class="review-cancel-btn" catchtap="closeReviewModal">å–æ¶ˆ</button>
      <button class="review-submit-btn" catchtap="submitReview">æäº¤è¯„ä»·</button>
    </view>
  </view>
</view>