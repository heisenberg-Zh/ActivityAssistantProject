<!-- pages/profile/index.wxml -->
<view class="section">
  <view class="card shadow-card profile-card">
    <!-- å¯ç‚¹å‡»çš„ç”¨æˆ·ä¿¡æ¯åŒºåŸŸï¼ˆæ¸¸å®¢é™¤å¤–ï¼‰ -->
    <view wx:if="{{user.name !== 'æ¸¸å®¢'}}" class="profile-head-clickable" bindtap="goEditProfile">
      <view class="row gap-16 profile-head">
        <!-- å¤´åƒï¼šä¼˜å…ˆæ˜¾ç¤ºå›¾ç‰‡ï¼Œæ— å›¾ç‰‡åˆ™æ˜¾ç¤ºé¦–å­—æ¯ -->
        <view class="profile-avatar-wrapper">
          <image wx:if="{{user.avatarUrl}}" class="profile-avatar-image" src="{{user.avatarUrl}}" mode="aspectFill" binderror="onAvatarError"></image>
          <view wx:else class="profile-avatar-text">{{user.initial}}</view>
        </view>
        <view class="flex-col profile-info">
          <view class="profile-name-row">
            <text class="text-xl text-gray-800">{{user.name}}</text>
            <text class="profile-arrow">â€º</text>
          </view>
        </view>
      </view>
    </view>

    <!-- æ¸¸å®¢çŠ¶æ€ï¼šä¸å¯ç‚¹å‡» -->
    <view wx:else class="row gap-16 profile-head">
      <view class="profile-avatar-wrapper">
        <view class="profile-avatar-text">{{user.initial}}</view>
      </view>
      <view class="flex-col">
        <text class="text-xl text-gray-800">{{user.name}}</text>
        <text class="text-sm text-gray-500">{{user.role}}</text>
      </view>
    </view>

    <text wx:if="{{user.tagline}}" class="profile-desc text-sm text-gray-600">{{user.tagline}}</text>

    <!-- æ¸¸å®¢çŠ¶æ€ç™»å½•æŒ‰é’® -->
    <view wx:if="{{user.name === 'æ¸¸å®¢'}}" class="login-prompt-btn" bindtap="goLogin">
      <view class="login-prompt-icon">ğŸ”</view>
      <text class="login-prompt-text">ç«‹å³ç™»å½•ï¼Œä½“éªŒå®Œæ•´åŠŸèƒ½</text>
      <view class="login-prompt-arrow">â†’</view>
    </view>
  </view>
</view>

<view class="section">
  <view class="card shadow-card stats-card">
    <text class="section-title">æˆ‘çš„æ•°æ®</text>
    <view class="stats-grid">
      <block wx:for="{{stats}}" wx:key="label" wx:for-item="item">
        <view class="stats-item">
          <view class="stats-icon" style="background: {{item.bg}}; color: {{item.color}};">{{item.icon}}</view>
          <text class="stats-value">{{item.value}}</text>
          <text class="stats-label">{{item.label}}</text>
        </view>
      </block>
    </view>
  </view>
</view>

<view class="section">
  <view class="card shadow-card menu-card">
    <view class="menu-list">
      <block wx:for="{{menuLinks}}" wx:key="key" wx:for-item="item">
        <view class="menu-item" bindtap="handleMenu" data-key="{{item.key}}">
          <view class="menu-icon" style="background: {{item.bg}}; color: {{item.color}};">{{item.icon}}</view>
          <text class="text-md text-gray-800">{{item.label}}</text>
          <text wx:if="{{item.badge}}" class="menu-badge">{{item.badge}}</text>
        </view>
      </block>
    </view>
  </view>
</view>

<view class="section">
  <!-- å·²ç™»å½•æ˜¾ç¤ºé€€å‡ºç™»å½•ï¼Œæ¸¸å®¢çŠ¶æ€éšè— -->
  <view wx:if="{{user.name !== 'æ¸¸å®¢'}}" class="logout-btn" bindtap="logout">é€€å‡ºç™»å½•</view>
</view>

<!-- å¸®åŠ©ä¸åé¦ˆå¼¹çª— -->
<view wx:if="{{showFeedbackModal}}" class="feedback-modal" bindtap="closeFeedbackModal">
  <view class="feedback-content" catchtap>
    <view class="feedback-header">
      <text class="feedback-title">å¸®åŠ©ä¸åé¦ˆ</text>
      <view class="feedback-close" bindtap="closeFeedbackModal">âœ•</view>
    </view>

    <view class="feedback-body">
      <text class="feedback-hint">å¦‚éœ€å¸®åŠ©æˆ–æœ‰æ„è§å’Œå»ºè®®ï¼Œæ¬¢è¿åé¦ˆ</text>
      <textarea
        class="feedback-textarea"
        placeholder="è¯·è¾“å…¥æ‚¨çš„åé¦ˆå†…å®¹..."
        placeholder-class="textarea-placeholder"
        maxlength="1000"
        value="{{feedbackContent}}"
        bindinput="onFeedbackInput"
        auto-height
        show-confirm-bar="{{false}}"
        cursor-spacing="20"
      />
      <text class="feedback-counter">{{feedbackCount}}/1000</text>
    </view>

    <view class="feedback-footer">
      <button class="feedback-btn feedback-btn--cancel" bindtap="closeFeedbackModal">å–æ¶ˆ</button>
      <button class="feedback-btn feedback-btn--submit" bindtap="submitFeedback">æäº¤</button>
    </view>
  </view>
</view>

<view class="bottom-space"></view>