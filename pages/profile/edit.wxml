<!-- pages/profile/edit.wxml -->
<view class="container">
  <!-- 列表式布局 -->
  <view class="profile-list">
    <!-- 头像 -->
    <view class="list-item">
      <text class="item-label">头像</text>
      <view class="item-value-wrapper">
        <button class="avatar-button" open-type="chooseAvatar" bindchooseavatar="onChooseAvatar">
          <image class="avatar-preview" src="{{avatarUrl}}" mode="aspectFill" binderror="onAvatarError"></image>
          <text class="item-arrow">›</text>
        </button>
      </view>
    </view>

    <!-- 昵称 -->
    <view class="list-item" bindtap="editNickname">
      <text class="item-label">昵称</text>
      <view class="item-value-wrapper">
        <text class="item-value">{{nickname || '请输入昵称'}}</text>
        <text class="item-arrow">›</text>
      </view>
    </view>

    <!-- 手机号 -->
    <view class="list-item" bindtap="editPhone">
      <text class="item-label">手机号</text>
      <view class="item-value-wrapper">
        <text class="item-value {{phone ? '' : 'placeholder'}}">{{phone || '选填'}}</text>
        <text class="item-arrow">›</text>
      </view>
    </view>

    <!-- 账户类型（只读） -->
    <view class="list-item readonly">
      <text class="item-label">账户类型</text>
      <view class="item-value-wrapper">
        <text class="item-value readonly-value">{{role}}</text>
      </view>
    </view>

    <!-- 用户ID（只读） -->
    <view class="list-item readonly">
      <text class="item-label">用户ID</text>
      <view class="item-value-wrapper">
        <text class="item-value readonly-value">{{userId}}</text>
      </view>
    </view>
  </view>

  <!-- 提示信息 -->
  <view class="tips-section">
    <text class="tips-text">💡 昵称和头像通过微信官方组件获取，符合隐私保护规范</text>
  </view>

  <!-- 保存按钮 -->
  <view class="save-section">
    <button class="save-btn" bindtap="saveProfile" disabled="{{!canSave}}">
      {{canSave ? '保存' : '保存中...'}}
    </button>
  </view>
</view>

<!-- 昵称编辑弹窗 -->
<view wx:if="{{showNicknameModal}}" class="modal-overlay" bindtap="closeNicknameModal">
  <view class="modal-content" catchtap>
    <view class="modal-header">
      <text class="modal-title">编辑昵称</text>
      <view class="modal-close" bindtap="closeNicknameModal">✕</view>
    </view>
    <view class="modal-body">
      <input
        type="nickname"
        class="modal-input"
        value="{{tempNickname}}"
        placeholder="请输入昵称"
        bindinput="onTempNicknameInput"
        maxlength="20"
        focus="{{showNicknameModal}}"
      />
      <text class="input-counter">{{tempNickname.length}}/20</text>
    </view>
    <view class="modal-footer">
      <button class="modal-btn cancel" bindtap="closeNicknameModal">取消</button>
      <button class="modal-btn confirm" bindtap="confirmNickname">确定</button>
    </view>
  </view>
</view>

<!-- 手机号编辑弹窗 -->
<view wx:if="{{showPhoneModal}}" class="modal-overlay" bindtap="closePhoneModal">
  <view class="modal-content" catchtap>
    <view class="modal-header">
      <text class="modal-title">编辑手机号</text>
      <view class="modal-close" bindtap="closePhoneModal">✕</view>
    </view>
    <view class="modal-body">
      <input
        type="number"
        class="modal-input"
        value="{{tempPhone}}"
        placeholder="请输入手机号（选填）"
        bindinput="onTempPhoneInput"
        maxlength="11"
        focus="{{showPhoneModal}}"
      />
      <text class="input-hint">用于接收活动通知</text>
    </view>
    <view class="modal-footer">
      <button class="modal-btn cancel" bindtap="closePhoneModal">取消</button>
      <button class="modal-btn confirm" bindtap="confirmPhone">确定</button>
    </view>
  </view>
</view>
