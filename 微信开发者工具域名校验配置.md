# 微信开发者工具域名校验配置（图文教程）

## ❌ 当前错误

```
request:fail url not in domain list
```

**原因**：微信开发者工具的域名校验仍然**开启**状态

---

## ✅ 正确配置步骤（请仔细检查）

### 第一步：找到"详情"按钮

**位置**：微信开发者工具**右上角**

```
┌─────────────────────────────────────────────────────────────┐
│  [编译] [预览] [真机调试] [清缓存] [切后台]  ...  [📱] [详情] │ ← 点击这里
└─────────────────────────────────────────────────────────────┘
```

**提示**：
- 如果看不到"详情"按钮，可能被其他按钮遮挡，尝试调整窗口大小
- 或者点击工具栏最右侧的"..."菜单

---

### 第二步：进入"本地设置"标签页

点击"详情"后会弹出一个窗口，**必须**点击**"本地设置"**标签：

```
┌────────────────────────────────────────────────────────┐
│  [项目配置]  [本地设置]  [域名信息]  [腾讯云]  ...    │
│              ^^^^^^^^^^^                                │
│              点击这里！                                  │
├────────────────────────────────────────────────────────┤
│                                                         │
│  ☐ ES6 转 ES5                                          │
│  ☐ 增强编译                                            │
│  ☐ 不校验合法域名、web-view(业务域名)、TLS 版本...    │ ← 找到这一行
│  ☐ 不校验 HTTPS 证书                                   │
│  ...                                                    │
└────────────────────────────────────────────────────────┘
```

**重要**：
- ⚠️ 不是"项目配置"，是"本地设置"！
- ⚠️ "本地设置"在第二个标签页位置

---

### 第三步：勾选域名校验选项

找到这一行（完整文字）：

```
☐ 不校验合法域名、web-view(业务域名)、TLS 版本以及 HTTPS 证书
```

**操作**：点击前面的复选框，**勾选**它：

```
☑ 不校验合法域名、web-view(业务域名)、TLS 版本以及 HTTPS 证书
   ^^^
   必须打勾！
```

---

### 第四步：关闭详情窗口并重新编译

1. 关闭"详情"窗口
2. 点击左上角的 **"编译"** 按钮
3. 查看控制台是否还有错误

---

## 🔍 如何确认配置成功

### 方法1：查看"本地设置"标签

再次打开"详情" → "本地设置"，确认：

```
☑ 不校验合法域名、web-view(业务域名)、TLS 版本以及 HTTPS 证书
```

**如果是勾选状态**，说明配置正确。

---

### 方法2：重新编译后查看控制台

**成功的标志**：
- ✅ 不再出现 `request:fail url not in domain list` 错误
- ✅ 能看到 `GET http://localhost:8082/api/activities` 请求
- ✅ 请求返回 200 或其他状态码（不是域名错误）

**失败的标志**：
- ❌ 仍然显示 `request:fail url not in domain list`
- ❌ 请求被拦截，没有发送到后端

---

## ⚠️ 常见问题

### 问题1：找不到"详情"按钮

**可能原因**：
- 窗口太小，按钮被隐藏
- 版本不同，位置不一样

**解决方案**：
1. 调整微信开发者工具窗口大小
2. 查找顶部工具栏的"..."菜单
3. 尝试使用快捷键（如果有）

---

### 问题2：没有"本地设置"标签

**可能原因**：
- 微信开发者工具版本过旧

**解决方案**：
1. 更新微信开发者工具到最新版本
2. 在"设置" → "通用设置"中查找类似选项

---

### 问题3：勾选后仍然报错

**可能原因**：
- 勾选后未重新编译
- 缓存未清理
- 后端服务未启动

**解决方案**：
1. **清除缓存**：工具栏 → "清缓存" → "清除全部缓存"
2. **重新编译**：点击"编译"按钮
3. **确认后端服务**：访问 http://localhost:8082/api/health
4. **重启开发者工具**：完全关闭后重新打开

---

### 问题4：每次打开项目都需要重新勾选

**原因**：微信开发者工具的安全机制

**解决方案**：
- 这是正常现象
- 每次打开项目时检查一次配置
- 养成习惯：打开项目 → 详情 → 本地设置 → 确认勾选

---

## 🔧 如果实在无法配置

### 临时方案：使用 Mock 模式

如果多次尝试仍然无法解决，可以暂时切换回 Mock 模式：

1. 打开 `utils/config.js`
2. 修改第 11 行：
   ```javascript
   const CURRENT_ENV = 'mock';
   ```
3. 保存并重新编译

**特点**：
- ✅ 无需后端服务
- ✅ 无需域名配置
- ✅ 可以测试前端功能
- ❌ 数据不会真正保存

---

## 📸 需要截图验证

如果按照以上步骤操作后仍然有问题，请提供以下截图：

1. **"详情" → "本地设置"** 的完整截图
2. **控制台的错误信息**截图
3. **微信开发者工具的版本号**（帮助 → 关于）

这样我可以更准确地帮你诊断问题。

---

## ✅ 配置成功的标志

完成配置后，控制台应该显示：

```
====== 环境配置 ======
当前环境: development
API地址: http://localhost:8082
使用Mock: false
====================

[API] GET http://localhost:8082/api/activities
[Response] 200 OK {...}
```

**而不是**：
```
❌ request:fail url not in domain list
```

---

## 🆘 需要帮助

如果按照以上所有步骤操作后仍然无法解决，请：

1. 提供微信开发者工具的版本号
2. 提供"本地设置"页面的完整截图
3. 描述具体的操作步骤

我会根据具体情况提供进一步的帮助。
