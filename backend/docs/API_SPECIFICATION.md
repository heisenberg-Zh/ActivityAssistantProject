# APIæ¥å£è§„èŒƒæ–‡æ¡£

**åŸºç¡€URL**ï¼š`http://localhost:8080` (å¼€å‘ç¯å¢ƒ)
**APIç‰ˆæœ¬**ï¼šv1.0
**åè®®**ï¼šHTTP/HTTPS
**æ•°æ®æ ¼å¼**ï¼šJSON

---

## ğŸ“‹ ç›®å½•

- [ä¸€ã€é€šç”¨è§„èŒƒ](#ä¸€é€šç”¨è§„èŒƒ)
- [äºŒã€è®¤è¯æˆæƒ](#äºŒè®¤è¯æˆæƒ)
- [ä¸‰ã€ç”¨æˆ·æ¨¡å—](#ä¸‰ç”¨æˆ·æ¨¡å—)
- [å››ã€æ´»åŠ¨æ¨¡å—](#å››æ´»åŠ¨æ¨¡å—)
- [äº”ã€æŠ¥åæ¨¡å—](#äº”æŠ¥åæ¨¡å—)
- [å…­ã€ç­¾åˆ°æ¨¡å—](#å…­ç­¾åˆ°æ¨¡å—)
- [ä¸ƒã€ç»Ÿè®¡æ¨¡å—](#ä¸ƒç»Ÿè®¡æ¨¡å—)
- [å…«ã€é”™è¯¯ç ](#å…«é”™è¯¯ç )

---

## ä¸€ã€é€šç”¨è§„èŒƒ

### 1.1 è¯·æ±‚å¤´

```
Content-Type: application/json
Authorization: Bearer {token}  # éœ€è¦è®¤è¯çš„æ¥å£å¿…é¡»æºå¸¦
```

### 1.2 ç»Ÿä¸€å“åº”æ ¼å¼

**æˆåŠŸå“åº”**ï¼š
```json
{
  "code": 0,
  "message": "success",
  "data": { ... }
}
```

**å¤±è´¥å“åº”**ï¼š
```json
{
  "code": 400,
  "message": "é”™è¯¯æè¿°",
  "data": null
}
```

### 1.3 åˆ†é¡µå‚æ•°

```json
{
  "page": 1,      // é¡µç ï¼ˆä»1å¼€å§‹ï¼‰
  "size": 20,     // æ¯é¡µæ•°é‡
  "sort": "createdAt,desc"  // æ’åºå­—æ®µ
}
```

**åˆ†é¡µå“åº”**ï¼š
```json
{
  "code": 0,
  "data": {
    "content": [...],     // æ•°æ®åˆ—è¡¨
    "totalElements": 100, // æ€»è®°å½•æ•°
    "totalPages": 5,      // æ€»é¡µæ•°
    "page": 1,            // å½“å‰é¡µ
    "size": 20            // æ¯é¡µæ•°é‡
  }
}
```

---

## äºŒã€è®¤è¯æˆæƒ

### 2.1 å¾®ä¿¡ç™»å½•

**æ¥å£**ï¼š`POST /api/auth/login`
**è¯´æ˜**ï¼šç”¨æˆ·é€šè¿‡å¾®ä¿¡codeç™»å½•ï¼Œè¿”å›JWT Token
**æ˜¯å¦éœ€è¦è®¤è¯**ï¼šå¦

**è¯·æ±‚å‚æ•°**ï¼š
```json
{
  "code": "string  // å¾®ä¿¡ç™»å½•å‡­è¯ï¼ˆå¼€å‘ç¯å¢ƒå¯ç”¨'test_code_dev'å¿«é€Ÿç™»å½•ï¼‰"
}
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "code": 0,
  "data": {
    "token": "eyJhbGciOiJIUzUxMiJ9...",
    "userInfo": {
      "id": "u1",
      "nickname": "å¼ å°åŒ—",
      "avatar": "/activityassistant_avatar_01.png",
      "mobile": "138****1234",
      "role": "user"
    }
  }
}
```

### 2.2 åˆ·æ–°Token

**æ¥å£**ï¼š`POST /api/auth/refresh`
**è¯´æ˜**ï¼šåˆ·æ–°è¿‡æœŸçš„Token
**æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

---

## ä¸‰ã€ç”¨æˆ·æ¨¡å—

### 3.1 è·å–ç”¨æˆ·ä¿¡æ¯

**æ¥å£**ï¼š`GET /api/user/profile`
**è¯´æ˜**ï¼šè·å–å½“å‰ç™»å½•ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯
**æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "code": 0,
  "data": {
    "id": "u1",
    "nickname": "å¼ å°åŒ—",
    "avatar": "/activityassistant_avatar_01.png",
    "mobile": "138****1234",
    "role": "user",
    "createdCount": 8,    // åˆ›å»ºæ´»åŠ¨æ•°
    "joinedCount": 15,    // å‚ä¸æ´»åŠ¨æ•°
    "checkinRate": 95     // ç­¾åˆ°ç‡ï¼ˆ%ï¼‰
  }
}
```

### 3.2 æ›´æ–°ç”¨æˆ·ä¿¡æ¯

**æ¥å£**ï¼š`PUT /api/user/profile`
**è¯´æ˜**ï¼šæ›´æ–°ç”¨æˆ·åŸºæœ¬ä¿¡æ¯
**æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

**è¯·æ±‚å‚æ•°**ï¼š
```json
{
  "nickname": "string  // æ˜µç§°",
  "mobile": "string    // æ‰‹æœºå·"
}
```

---

## å››ã€æ´»åŠ¨æ¨¡å—

### 4.1 æ´»åŠ¨åˆ—è¡¨

**æ¥å£**ï¼š`GET /api/activities`
**è¯´æ˜**ï¼šè·å–æ´»åŠ¨åˆ—è¡¨ï¼ˆæ”¯æŒç­›é€‰å’Œåˆ†é¡µï¼‰
**æ˜¯å¦éœ€è¦è®¤è¯**ï¼šå¦ï¼ˆå…¬å¼€æ´»åŠ¨ï¼‰/ æ˜¯ï¼ˆç§å¯†æ´»åŠ¨ï¼‰

**æŸ¥è¯¢å‚æ•°**ï¼š
```
?type=è¿åŠ¨              // æ´»åŠ¨ç±»å‹ç­›é€‰
&status=published      // çŠ¶æ€ç­›é€‰
&keyword=ç½‘çƒ          // å…³é”®è¯æœç´¢
&page=1               // é¡µç 
&size=20              // æ¯é¡µæ•°é‡
&sort=startTime,asc   // æ’åº
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "code": 0,
  "data": {
    "content": [
      {
        "id": "a1",
        "title": "å‘¨æœ«ç½‘çƒæ´»åŠ¨",
        "type": "è¿åŠ¨",
        "status": "published",
        "startTime": "2025-12-15T14:00:00",
        "place": "å¥¥ä½“ä¸­å¿ƒç½‘çƒåœº",
        "total": 20,
        "joined": 13,
        "fee": 0,
        "banner": "blue",
        "organizerName": "å¼ å°åŒ—"
      }
    ],
    "totalElements": 30,
    "totalPages": 2,
    "page": 1,
    "size": 20
  }
}
```

### 4.2 æ´»åŠ¨è¯¦æƒ…

**æ¥å£**ï¼š`GET /api/activities/:id`
**è¯´æ˜**ï¼šè·å–æ´»åŠ¨å®Œæ•´ä¿¡æ¯ï¼ˆåŒ…å«åˆ†ç»„ã€è‡ªå®šä¹‰å­—æ®µï¼‰
**æ˜¯å¦éœ€è¦è®¤è¯**ï¼šå¦ï¼ˆå…¬å¼€æ´»åŠ¨ï¼‰/ æ˜¯ï¼ˆç§å¯†æ´»åŠ¨ï¼‰

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "code": 0,
  "data": {
    "id": "a1",
    "title": "å‘¨æœ«ç½‘çƒæ´»åŠ¨",
    "description": "å¥¥ä½“ä¸­å¿ƒç½‘çƒåœº...",
    "type": "è¿åŠ¨",
    "status": "published",
    "startTime": "2025-12-15T14:00:00",
    "endTime": "2025-12-15T18:00:00",
    "registerDeadline": "2025-12-15T12:00:00",
    "place": "å¥¥ä½“ä¸­å¿ƒç½‘çƒåœº",
    "address": "åŒ—äº¬å¸‚æœé˜³åŒºå¥¥ä½“ä¸­å¿ƒ",
    "latitude": 39.9928,
    "longitude": 116.3972,
    "checkinRadius": 500,
    "total": 20,
    "joined": 13,
    "minParticipants": 10,
    "fee": 0,
    "feeType": "å…è´¹",
    "needReview": false,
    "isPublic": true,
    "organizerId": "u1",
    "organizerName": "å¼ å°åŒ—",
    "tags": ["è¿åŠ¨", "ç½‘çƒ", "å‘¨æœ«"],
    "requirements": "è¯·è‡ªå¸¦çƒæ‹å’Œè¿åŠ¨è£…å¤‡",

    // åˆ†ç»„ä¿¡æ¯ï¼ˆå¦‚æœæœ‰ï¼‰
    "groups": [
      {
        "id": "g1",
        "name": "Aç»„-åŸºç¡€æ•™å­¦",
        "total": 12,
        "joined": 8,
        "fee": 50,
        "customFields": [
          {
            "id": "name",
            "label": "æ˜µç§°",
            "required": true,
            "isCustom": false
          },
          {
            "id": "custom_1",
            "label": "ç½‘çƒç»éªŒ",
            "required": false,
            "isCustom": true
          }
        ]
      }
    ],

    "createdAt": "2025-12-10T10:00:00"
  }
}
```

### 4.3 åˆ›å»ºæ´»åŠ¨

**æ¥å£**ï¼š`POST /api/activities`
**è¯´æ˜**ï¼šåˆ›å»ºæ–°æ´»åŠ¨
**æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

**è¯·æ±‚å‚æ•°**ï¼š
```json
{
  "title": "string",
  "description": "string",
  "type": "string",  // è¿åŠ¨/èšä¼š/åŸ¹è®­/æˆ·å¤–
  "startTime": "2025-12-15T14:00:00",
  "endTime": "2025-12-15T18:00:00",
  "registerDeadline": "2025-12-15T12:00:00",
  "place": "string",
  "address": "string",
  "latitude": 39.9928,
  "longitude": 116.3972,
  "checkinRadius": 500,
  "total": 20,
  "minParticipants": 10,
  "fee": 0,
  "feeType": "å…è´¹",
  "needReview": false,
  "isPublic": true,
  "groups": [...]  // å¯é€‰ï¼šåˆ†ç»„æ•°æ®
}
```

### 4.4 æ›´æ–°æ´»åŠ¨

**æ¥å£**ï¼š`PUT /api/activities/:id`
**è¯´æ˜**ï¼šæ›´æ–°æ´»åŠ¨ä¿¡æ¯ï¼ˆä»…ç»„ç»‡è€…/ç®¡ç†å‘˜ï¼‰
**æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### 4.5 åˆ é™¤æ´»åŠ¨

**æ¥å£**ï¼š`DELETE /api/activities/:id`
**è¯´æ˜**ï¼šåˆ é™¤æ´»åŠ¨ï¼ˆè½¯åˆ é™¤ï¼‰
**æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯ï¼ˆä»…ç»„ç»‡è€…ï¼‰

---

## äº”ã€æŠ¥åæ¨¡å—

### 5.1 æäº¤æŠ¥å

**æ¥å£**ï¼š`POST /api/registrations`
**è¯´æ˜**ï¼šç”¨æˆ·æŠ¥åå‚åŠ æ´»åŠ¨
**æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

**è¯·æ±‚å‚æ•°**ï¼š
```json
{
  "activityId": "string",
  "groupId": "string",  // å¦‚æœæ´»åŠ¨æœ‰åˆ†ç»„
  "name": "string",
  "mobile": "string",
  "customData": {       // è‡ªå®šä¹‰å­—æ®µå€¼
    "çƒé¾„": "3ä¸ªæœˆ",
    "Tæ¤å°ºç ": "L"
  }
}
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "code": 0,
  "data": {
    "id": "r1",
    "activityId": "a1",
    "status": "approved",  // pending/approved/rejected
    "registeredAt": "2025-12-14T12:30:00"
  },
  "message": "æŠ¥åæˆåŠŸ"
}
```

### 5.2 å–æ¶ˆæŠ¥å

**æ¥å£**ï¼š`DELETE /api/registrations/:id`
**è¯´æ˜**ï¼šå–æ¶ˆå·²æŠ¥åçš„æ´»åŠ¨
**æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### 5.3 æŸ¥è¯¢æŠ¥ååˆ—è¡¨

**æ¥å£**ï¼š`GET /api/registrations/activity/:activityId`
**è¯´æ˜**ï¼šæŸ¥è¯¢æ´»åŠ¨çš„æŠ¥ååˆ—è¡¨ï¼ˆä»…ç»„ç»‡è€…/ç®¡ç†å‘˜ï¼‰
**æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### 5.4 å®¡æ ¸æŠ¥å

**æ¥å£**ï¼š`PUT /api/registrations/:id/approve`
**è¯´æ˜**ï¼šå®¡æ ¸æŠ¥åç”³è¯·
**æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯ï¼ˆä»…ç»„ç»‡è€…/ç®¡ç†å‘˜ï¼‰

**è¯·æ±‚å‚æ•°**ï¼š
```json
{
  "approved": true  // true=é€šè¿‡ï¼Œfalse=æ‹’ç»
}
```

---

## å…­ã€ç­¾åˆ°æ¨¡å—

### 6.1 æäº¤ç­¾åˆ°

**æ¥å£**ï¼š`POST /api/checkins`
**è¯´æ˜**ï¼šç”¨æˆ·ç­¾åˆ°ï¼ˆéœ€éªŒè¯GPSä½ç½®ï¼‰
**æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

**è¯·æ±‚å‚æ•°**ï¼š
```json
{
  "activityId": "string",
  "latitude": 39.9928,
  "longitude": 116.3972,
  "address": "string"
}
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "code": 0,
  "data": {
    "id": "c1",
    "activityId": "a1",
    "checkinTime": "2025-12-15T14:05:00",
    "isLate": false,
    "isValid": true,
    "distance": 25  // è·ç¦»æ´»åŠ¨åœ°ç‚¹çš„è·ç¦»ï¼ˆç±³ï¼‰
  },
  "message": "ç­¾åˆ°æˆåŠŸ"
}
```

### 6.2 æŸ¥è¯¢ç­¾åˆ°è®°å½•

**æ¥å£**ï¼š`GET /api/checkins/activity/:activityId`
**è¯´æ˜**ï¼šæŸ¥è¯¢æ´»åŠ¨çš„ç­¾åˆ°è®°å½•
**æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯ï¼ˆä»…ç»„ç»‡è€…/ç®¡ç†å‘˜ï¼‰

---

## ä¸ƒã€ç»Ÿè®¡æ¨¡å—

### 7.1 æ´»åŠ¨ç»Ÿè®¡

**æ¥å£**ï¼š`GET /api/statistics/activities/:id`
**è¯´æ˜**ï¼šè·å–æ´»åŠ¨çš„è¯¦ç»†ç»Ÿè®¡æ•°æ®
**æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯ï¼ˆä»…ç»„ç»‡è€…/ç®¡ç†å‘˜ï¼‰

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "code": 0,
  "data": {
    "activityId": "a1",
    "registrationStats": {
      "total": 20,        // æ€»æŠ¥åäººæ•°
      "approved": 18,     // å·²é€šè¿‡
      "pending": 2,       // å¾…å®¡æ ¸
      "cancelled": 1      // å·²å–æ¶ˆ
    },
    "checkinStats": {
      "total": 15,        // å·²ç­¾åˆ°äººæ•°
      "late": 2,          // è¿Ÿåˆ°äººæ•°
      "rate": 83.3        // ç­¾åˆ°ç‡ï¼ˆ%ï¼‰
    },
    "groupStats": [       // åˆ†ç»„ç»Ÿè®¡
      {
        "groupId": "g1",
        "name": "Aç»„",
        "registered": 10,
        "checkedin": 8
      }
    ]
  }
}
```

### 7.2 ç”¨æˆ·ç»Ÿè®¡

**æ¥å£**ï¼š`GET /api/statistics/users/:id`
**è¯´æ˜**ï¼šè·å–ç”¨æˆ·çš„å‚ä¸ç»Ÿè®¡
**æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### 7.3 è¶‹åŠ¿ç»Ÿè®¡

**æ¥å£**ï¼š`GET /api/statistics/trends`
**è¯´æ˜**ï¼šè·å–æœˆåº¦è¶‹åŠ¿æ•°æ®
**æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

---

## å…«ã€é”™è¯¯ç 

| é”™è¯¯ç  | è¯´æ˜ | HTTPçŠ¶æ€ç  |
|-------|------|-----------|
| 0 | æˆåŠŸ | 200 |
| 400 | è¯·æ±‚å‚æ•°é”™è¯¯ | 400 |
| 401 | æœªè®¤è¯ï¼ˆTokenæ— æ•ˆæˆ–è¿‡æœŸï¼‰ | 401 |
| 403 | æ— æƒé™ | 403 |
| 404 | èµ„æºä¸å­˜åœ¨ | 404 |
| 409 | èµ„æºå†²çªï¼ˆå¦‚é‡å¤æŠ¥åï¼‰ | 409 |
| 429 | è¯·æ±‚è¿‡äºé¢‘ç¹ | 429 |
| 500 | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ | 500 |

**å¸¸è§ä¸šåŠ¡é”™è¯¯ç **ï¼š
- `1001`: ç”¨æˆ·ä¸å­˜åœ¨
- `2001`: æ´»åŠ¨ä¸å­˜åœ¨
- `2002`: æ´»åŠ¨å·²æ»¡å‘˜
- `2003`: æŠ¥åå·²æˆªæ­¢
- `2004`: ä¸åœ¨æŠ¥åæ—¶é—´èŒƒå›´å†…
- `3001`: å·²ç»æŠ¥åï¼Œè¯·å‹¿é‡å¤æŠ¥å
- `3002`: æœªæŠ¥åï¼Œæ— æ³•ç­¾åˆ°
- `4001`: ç­¾åˆ°ä½ç½®è¶…å‡ºèŒƒå›´
- `4002`: ä¸åœ¨ç­¾åˆ°æ—¶é—´èŒƒå›´å†…

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **è¯¦ç»†APIæ–‡æ¡£ï¼ˆSwaggerï¼‰**ï¼šhttp://localhost:8080/swagger-ui.html
- **Postmané›†åˆ**ï¼š`postman_collection.json`ï¼ˆåç»­æä¾›ï¼‰
- **å®‰å…¨è§„èŒƒ**ï¼š`../API_SECURITY_SPEC.md`

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0
**æœ€åæ›´æ–°**ï¼š2025-01-08
**ç»´æŠ¤è€…**ï¼šClaude
