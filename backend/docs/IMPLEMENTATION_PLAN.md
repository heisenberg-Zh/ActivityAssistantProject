# ActivityAssistant 后端项目完整实施计划

**项目名称**：ActivityAssistant 活动助手后端系统
**技术栈**：Java 17 + Spring Boot 3.2 + MySQL 8.0 + Redis
**开发模式**：分阶段交付，边开发边验证
**文档版本**：v2.0
**创建日期**：2025-01-08
**最后更新**：2025-11-10
**预计工期**：13周

**当前进度**：阶段0 ✅ 100% | 阶段1 ✅ 100% | 整体进度 40%

---

## 📋 目录

- [一、项目概述](#一项目概述)
- [二、技术架构](#二技术架构)
- [三、开发环境要求](#三开发环境要求)
- [四、分阶段实施计划](#四分阶段实施计划)
- [五、开发规范](#五开发规范)
- [六、质量保证](#六质量保证)
- [七、风险管理](#七风险管理)
- [八、验收标准](#八验收标准)

---

## 一、项目概述

### 1.1 项目背景

本项目为微信小程序"ActivityAssistant"提供后端API服务。前端已完成基于 mock.js 的界面开发，现需要开发真实的后端系统替换假数据。

### 1.2 核心目标

- ✅ 实现完整的后端 RESTful API
- ✅ 支持微信小程序登录鉴权
- ✅ 实现活动、报名、签到、统计等核心功能
- ✅ 确保数据安全和权限控制
- ✅ 支持高并发（目标1000+在线用户）

### 1.3 项目特点

**数据结构特点**：
- 多层嵌套（活动 → 分组 → 自定义字段）
- 动态字段（不同活动的报名字段完全不同）
- 复杂权限（组织者、管理员、白名单、黑名单）

**技术选型依据**：
- **Java + Spring Boot**：开发者有Java经验，无学习成本
- **MySQL + JSON字段**：兼顾关系型数据的一致性和JSON的灵活性
- **分阶段交付**：降低风险，便于及时调整

---

## 二、技术架构

### 2.1 整体架构

```
┌─────────────────────────────────────────────────┐
│            微信小程序前端                          │
│         (已完成，基于 mock.js)                     │
└───────────────────┬─────────────────────────────┘
                    │ HTTPS
                    │ RESTful API
┌───────────────────▼─────────────────────────────┐
│              Nginx (反向代理)                     │
│         - SSL 证书                               │
│         - 负载均衡（后期）                          │
└───────────────────┬─────────────────────────────┘
                    │
┌───────────────────▼─────────────────────────────┐
│         Spring Boot 应用层                        │
│  ┌─────────────────────────────────────────┐   │
│  │  Controller 层（接口控制）                 │   │
│  │  - AuthController (登录)                 │   │
│  │  - ActivityController (活动管理)          │   │
│  │  - RegistrationController (报名)         │   │
│  │  - CheckinController (签到)              │   │
│  │  - StatisticsController (统计)           │   │
│  └────────────┬────────────────────────────┘   │
│               │                                 │
│  ┌────────────▼────────────────────────────┐   │
│  │  Service 层（业务逻辑）                    │   │
│  │  - 权限校验                               │   │
│  │  - 数据验证                               │   │
│  │  - 业务规则                               │   │
│  └────────────┬────────────────────────────┘   │
│               │                                 │
│  ┌────────────▼────────────────────────────┐   │
│  │  Repository 层（数据访问）                 │   │
│  │  - JPA Repository                        │   │
│  │  - 自定义查询                             │   │
│  └────────────┬────────────────────────────┘   │
└───────────────┼─────────────────────────────────┘
                │
        ┌───────┴───────┐
        │               │
┌───────▼──────┐ ┌─────▼──────┐
│   MySQL 8.0  │ │   Redis    │
│  (主数据库)   │ │ (缓存/Session)│
└──────────────┘ └────────────┘
```

### 2.2 技术栈详细清单

| 类别 | 技术 | 版本 | 用途 |
|-----|------|------|------|
| **核心框架** | Spring Boot | 3.2.x | 应用框架 |
| **开发语言** | Java | 17 (LTS) | 编程语言 |
| **构建工具** | Maven | 3.9+ | 依赖管理 |
| **数据库** | MySQL | 8.0+ | 关系型数据库 |
| **缓存** | Redis | 7.0+ | 缓存、Session |
| **ORM框架** | Spring Data JPA | 3.2.x | 数据访问 |
| **JSON处理** | Jackson | 2.15+ | JSON序列化 |
| **代码简化** | Lombok | 1.18+ | 减少样板代码 |
| **对象映射** | MapStruct | 1.5+ | DTO转换 |
| **安全框架** | Spring Security | 6.2+ | 认证授权 |
| **JWT** | jjwt | 0.12+ | Token生成 |
| **微信SDK** | WxJava | 4.6+ | 微信API调用 |
| **数据验证** | Validation | 3.0+ | 参数校验 |
| **API文档** | SpringDoc OpenAPI | 2.3+ | Swagger文档 |
| **测试框架** | JUnit 5 | 5.10+ | 单元测试 |

### 2.3 数据库设计概览

**核心表结构**（共5张主表）：

```sql
1. users              -- 用户表
2. activities         -- 活动表（JSON存储分组、白名单等）
3. registrations      -- 报名表（JSON存储自定义字段值）
4. checkins           -- 签到记录表
5. messages           -- 消息通知表
```

**特殊字段说明**：
- `activities.groups`：JSON字段，存储分组数组及自定义字段定义
- `activities.administrators`：JSON字段，存储管理员列表
- `registrations.custom_data`：JSON字段，存储用户填写的自定义字段值

详细设计见：`docs/DATABASE_DESIGN.md`

---

## 三、开发环境要求

### 3.1 必需工具清单

| 工具 | 版本要求 | 安装指南 |
|-----|---------|---------|
| JDK | 17+ | 见 `docs/SETUP_GUIDE.md` |
| Maven | 3.9+ | 见 `docs/SETUP_GUIDE.md` |
| IntelliJ IDEA | 2023.2+ | 见 `docs/SETUP_GUIDE.md` |
| MySQL | 8.0+ | 见 `docs/SETUP_GUIDE.md` |
| Redis | 7.0+ (可选) | 见 `docs/SETUP_GUIDE.md` |
| Postman | 最新版 | 用于API测试 |
| Git | 2.40+ | 版本控制 |

### 3.2 开发环境配置模式

**双环境配置**：

```yaml
# application-dev.yml (开发环境)
- 本地MySQL数据库
- 模拟微信登录（跳过真实验证）
- 日志级别：DEBUG
- 不需要真实AppSecret

# application-prod.yml (生产环境)
- 云数据库（后期）
- 真实微信登录
- 日志级别：INFO
- 需要配置真实AppSecret
```

### 3.3 初始化步骤

1. 安装开发工具（参考 `docs/SETUP_GUIDE.md`）
2. 创建数据库：`CREATE DATABASE activity_assistant;`
3. 运行初始化脚本：`scripts/init-schema.sql`
4. 导入测试数据：`scripts/init-data.sql`
5. 配置IDEA并运行项目

---

## 四、分阶段实施计划

### 总览

| 阶段 | 名称 | 工期 | 核心功能 | 交付物 |
|-----|------|------|---------|--------|
| **阶段1** | 项目框架 + 用户认证 | 3天 | 项目搭建、登录注册 | 可运行的基础框架 |
| **阶段2** | 活动管理 | 4天 | 活动CRUD、分组管理 | 活动管理完整功能 |
| **阶段3** | 报名管理 | 3天 | 报名、审核、白名单 | 报名系统 |
| **阶段4** | 签到 + 统计 | 3天 | GPS签到、数据统计 | 签到和统计功能 |

**总工期**：约13天（纯开发时间）

---

### 阶段1：项目框架 + 用户认证（第1-3天）

#### 目标
搭建项目基础框架，实现用户登录功能，确保前后端能通信。

#### 详细任务清单

**Day 1：项目初始化**
- [x] 创建 Maven 项目结构
- [x] 配置 pom.xml（所有依赖）
- [x] 创建包结构（controller/service/repository/model/dto）
- [x] 配置 application.yml（dev/prod双环境）
- [x] 创建数据库并运行建表脚本
- [x] 配置 Lombok 和 MapStruct
- [x] 配置 Swagger API 文档
- [x] 编写统一返回格式 `ApiResponse<T>`
- [x] 编写全局异常处理 `GlobalExceptionHandler`
- [x] 编写常量类和工具类

**Day 2：用户模块**
- [x] 创建 User 实体类
- [x] 创建 UserRepository
- [x] 创建 UserService
- [x] 创建 UserController
- [x] 实现微信登录功能（dev模式：mock登录，prod模式：真实登录）
- [x] 实现 JWT Token 生成和验证
- [x] 实现获取用户信息接口
- [x] 实现更新用户信息接口

**Day 3：认证授权**
- [x] 配置 Spring Security
- [x] 创建 JWT 认证过滤器
- [x] 实现 Token 拦截和验证
- [x] 实现SecurityUtils（从上下文获取用户信息）
- [x] 使用 curl 测试所有用户接口
- [x] 编写 API 文档（Swagger）

#### 交付物
- ✅ 可运行的 Spring Boot 项目
- ✅ 完整的用户登录功能
- ✅ Swagger API 文档（`http://localhost:8080/swagger-ui.html`）
- ✅ Postman 接口集合
- ✅ 单元测试覆盖率 > 70%

#### 验收标准
- [x] 项目能正常启动，无报错（端口8082）
- [x] Postman 调用登录接口返回 Token
- [x] 携带 Token 能成功访问需要认证的接口
- [x] 不携带 Token 访问受保护接口返回 401
- [x] dev 模式可以快速登录（不需要真实微信，code="test_code_dev"）

**实际完成时间**：2025-11-10
**开发总结**：
- 成功搭建项目框架，29个Java源文件
- 实现用户认证模块，5个API接口上线
- 遇到并解决4个技术问题（详见DEVELOPMENT_PROGRESS.md）
- 所有验收标准已达成

---

### 阶段2：活动管理（第4-7天）

#### 目标
实现活动的增删改查，支持分组、自定义字段、权限管理等复杂功能。

#### 详细任务清单

**Day 4：活动基础功能**
- [ ] 创建 Activity 实体类（包含JSON字段）
- [ ] 创建 ActivityRepository
- [ ] 创建 ActivityService
- [ ] 创建 ActivityController
- [ ] 实现创建活动接口（支持分组和自定义字段）
- [ ] 实现活动列表查询（分页、筛选、搜索）
- [ ] 实现活动详情查询

**Day 5：活动高级功能**
- [ ] 实现更新活动接口（权限校验）
- [ ] 实现删除活动接口（软删除）
- [ ] 实现活动管理员管理（添加/移除管理员）
- [ ] 实现白名单/黑名单管理
- [ ] 实现私密活动访问权限控制
- [ ] 实现活动状态管理（草稿/发布/进行中/已结束）

**Day 6：分组和自定义字段**
- [ ] 优化分组数据的JSON存储和查询
- [ ] 实现自定义字段验证逻辑
- [ ] 实现复制活动功能
- [ ] 实现定时发布功能（定时任务）
- [ ] 实现周期性活动管理

**Day 7：测试和优化**
- [ ] 编写活动模块单元测试
- [ ] 使用 Postman 测试所有活动接口
- [ ] 性能优化（查询优化、缓存）
- [ ] 前端对接测试（活动列表、详情、创建）

#### 交付物
- ✅ 完整的活动管理功能
- ✅ 支持复杂的分组和自定义字段
- ✅ API 文档更新
- ✅ Postman 测试用例
- ✅ 单元测试覆盖率 > 70%

#### 验收标准
- [ ] 能创建带分组的活动，分组包含自定义字段
- [ ] 能查询活动列表（支持类型、状态筛选）
- [ ] 能查询活动详情（包含完整的分组和字段信息）
- [ ] 非组织者不能修改/删除活动
- [ ] 私密活动只有白名单用户能查看
- [ ] 前端能成功对接活动列表和详情页

---

### 阶段3：报名管理（第8-10天）

#### 目标
实现报名、取消报名、审核、白名单等功能，确保名额控制准确。

#### 详细任务清单

**Day 8：报名基础功能**
- [ ] 创建 Registration 实体类（包含自定义字段值）
- [ ] 创建 RegistrationRepository
- [ ] 创建 RegistrationService
- [ ] 创建 RegistrationController
- [ ] 实现提交报名接口（支持自定义字段）
- [ ] 实现取消报名接口
- [ ] 实现报名列表查询（组织者查看）

**Day 9：报名高级功能**
- [ ] 实现报名审核功能（批量审核）
- [ ] 实现名额控制（并发处理、锁机制）
- [ ] 实现候补名单功能
- [ ] 实现报名截止时间控制
- [ ] 实现白名单自动通过
- [ ] 实现黑名单拦截

**Day 10：测试和优化**
- [ ] 编写报名模块单元测试
- [ ] 并发报名压力测试
- [ ] 使用 Postman 测试所有报名接口
- [ ] 前端对接测试（报名页面）

#### 交付物
- ✅ 完整的报名管理功能
- ✅ 名额控制准确，无超额风险
- ✅ API 文档更新
- ✅ 并发测试报告

#### 验收标准
- [ ] 能成功报名活动，填写自定义字段
- [ ] 活动满员后无法继续报名
- [ ] 报名截止后无法报名
- [ ] 黑名单用户无法报名
- [ ] 白名单用户自动通过审核
- [ ] 并发100人同时报名，名额控制准确

---

### 阶段4：签到 + 统计（第11-13天）

#### 目标
实现GPS签到、数据统计、消息通知功能。

#### 详细任务清单

**Day 11：签到功能**
- [ ] 创建 Checkin 实体类
- [ ] 创建 CheckinRepository
- [ ] 创建 CheckinService
- [ ] 创建 CheckinController
- [ ] 实现提交签到接口（GPS位置验证）
- [ ] 实现签到记录查询
- [ ] 实现签到防作弊机制
- [ ] 实现迟到判断

**Day 12：统计功能**
- [ ] 创建 StatisticsService
- [ ] 创建 StatisticsController
- [ ] 实现活动统计（报名人数、签到率）
- [ ] 实现用户统计（创建活动数、参与活动数）
- [ ] 实现趋势统计（月度趋势）
- [ ] 实现类型分布统计
- [ ] 实现数据导出功能（Excel）

**Day 13：消息通知 + 收尾**
- [ ] 创建 Message 实体类
- [ ] 创建 MessageService
- [ ] 实现消息列表查询
- [ ] 实现消息标记已读
- [ ] 集成微信模板消息（可选）
- [ ] 编写签到和统计模块单元测试
- [ ] 全面测试所有功能
- [ ] 性能优化和代码审查
- [ ] 编写部署文档

#### 交付物
- ✅ 完整的签到功能
- ✅ 完整的数据统计功能
- ✅ 消息通知功能
- ✅ 所有模块单元测试
- ✅ 部署文档

#### 验收标准
- [ ] 能在活动地点范围内成功签到
- [ ] 超出范围无法签到或记录异常
- [ ] 能查看活动的报名和签到统计
- [ ] 能查看用户的参与统计
- [ ] 能导出统计数据为Excel
- [ ] 所有核心功能测试通过

---

## 五、开发规范

### 5.1 代码规范

**遵循阿里巴巴Java开发手册**

1. **命名规范**
   - 类名：大驼峰（`UserService`）
   - 方法名：小驼峰（`getUserById`）
   - 常量：全大写下划线（`MAX_USER_COUNT`）
   - 包名：全小写（`com.activityassistant.service`）

2. **注释规范**
   ```java
   /**
    * 创建活动
    *
    * @param request 创建活动请求
    * @return 活动详情
    * @throws BusinessException 当用户权限不足时
    */
   public ActivityDTO createActivity(CreateActivityRequest request) {
       // 实现逻辑
   }
   ```

3. **异常处理**
   ```java
   // 使用自定义业务异常
   if (activity == null) {
       throw new NotFoundException("活动不存在");
   }

   // 统一异常处理
   @ControllerAdvice
   public class GlobalExceptionHandler {
       @ExceptionHandler(BusinessException.class)
       public ResponseEntity<?> handleBusinessException(BusinessException e) {
           return ResponseEntity.status(e.getCode())
               .body(ApiResponse.error(e.getCode(), e.getMessage()));
       }
   }
   ```

### 5.2 Git 提交规范

**Commit Message 格式**：

```
<type>(<scope>): <subject>

<body>
```

**Type 类型**：
- `feat`: 新功能
- `fix`: 修复Bug
- `docs`: 文档更新
- `style`: 代码格式（不影响功能）
- `refactor`: 重构
- `test`: 测试
- `chore`: 构建/工具变动

**示例**：
```
feat(activity): 实现活动创建功能

- 支持分组创建
- 支持自定义字段
- 实现权限校验
```

### 5.3 包结构规范

```
com.activityassistant
├── config/              # 配置类
├── controller/          # 控制器
├── service/            # 业务逻辑
│   └── impl/           # 实现类
├── repository/         # 数据访问
├── model/              # 实体类
│   ├── entity/         # 数据库实体
│   └── enums/          # 枚举
├── dto/                # 数据传输对象
│   ├── request/        # 请求DTO
│   └── response/       # 响应DTO
├── mapper/             # MapStruct映射器
├── security/           # 安全相关
├── exception/          # 异常定义
├── util/               # 工具类
└── constant/           # 常量
```

### 5.4 API 设计规范

**RESTful API 规范**：

```
GET    /api/activities          # 查询活动列表
GET    /api/activities/:id      # 查询活动详情
POST   /api/activities          # 创建活动
PUT    /api/activities/:id      # 更新活动
DELETE /api/activities/:id      # 删除活动
```

**统一返回格式**：

```json
// 成功
{
  "code": 0,
  "message": "success",
  "data": { ... }
}

// 失败
{
  "code": 400,
  "message": "参数验证失败",
  "data": null
}
```

---

## 六、质量保证

### 6.1 测试策略

| 测试类型 | 覆盖率目标 | 工具 | 负责人 |
|---------|-----------|------|--------|
| 单元测试 | > 70% | JUnit 5 + Mockito | Claude |
| 接口测试 | 100% | Postman | 用户 + Claude |
| 性能测试 | 核心接口 | JMeter | Claude |
| 安全测试 | 核心功能 | 手动 | Claude |

### 6.2 代码审查

**每个阶段完成后进行代码审查**：
- [ ] 是否遵循代码规范
- [ ] 是否有安全漏洞
- [ ] 是否有性能问题
- [ ] 是否有重复代码
- [ ] 注释是否完整

### 6.3 性能指标

| 指标 | 目标值 | 验证方式 |
|-----|--------|---------|
| API 响应时间 | < 200ms | Postman测试 |
| 并发处理能力 | > 500 QPS | JMeter压测 |
| 数据库查询时间 | < 50ms | Slow Query Log |
| 内存占用 | < 512MB | JVM 监控 |

---

## 七、风险管理

### 7.1 技术风险

| 风险 | 概率 | 影响 | 应对措施 |
|-----|------|------|---------|
| JSON字段查询性能差 | 中 | 中 | 建立辅助索引，热点数据缓存 |
| 并发报名名额超卖 | 中 | 高 | 使用数据库锁，Redis分布式锁 |
| 微信API调用失败 | 低 | 中 | 实现重试机制，降级处理 |
| GPS定位不准确 | 中 | 低 | 扩大签到范围，人工审核 |

### 7.2 进度风险

| 风险 | 应对措施 |
|-----|---------|
| 开发时间超期 | 每个阶段设置缓冲时间 |
| 需求变更 | 及时沟通，评估影响 |
| 技术难题 | 及时反馈，调整方案 |

---

## 八、验收标准

### 8.1 功能验收

**核心功能清单**：

- [ ] **用户模块**
  - [ ] 微信登录
  - [ ] 获取用户信息
  - [ ] 更新用户信息

- [ ] **活动模块**
  - [ ] 创建活动（支持分组和自定义字段）
  - [ ] 查询活动列表（筛选、搜索、分页）
  - [ ] 查询活动详情
  - [ ] 更新活动
  - [ ] 删除活动
  - [ ] 管理员管理
  - [ ] 白名单/黑名单管理

- [ ] **报名模块**
  - [ ] 提交报名
  - [ ] 取消报名
  - [ ] 报名审核
  - [ ] 查询报名列表
  - [ ] 名额控制

- [ ] **签到模块**
  - [ ] GPS签到
  - [ ] 查询签到记录
  - [ ] 签到统计

- [ ] **统计模块**
  - [ ] 活动统计
  - [ ] 用户统计
  - [ ] 趋势分析
  - [ ] 数据导出

### 8.2 非功能验收

- [ ] **性能**：核心API响应时间 < 200ms
- [ ] **安全**：通过安全测试，无明显漏洞
- [ ] **稳定性**：连续运行24小时无崩溃
- [ ] **文档**：API文档完整，部署文档清晰
- [ ] **代码质量**：单元测试覆盖率 > 70%

---

## 九、后续计划

### 9.1 功能增强（V2.0）

- [ ] 微信群接龙报名
- [ ] 支付功能（微信支付）
- [ ] 活动评论和评分
- [ ] 活动推荐算法
- [ ] 数据看板（管理后台）

### 9.2 性能优化

- [ ] Redis缓存优化
- [ ] 数据库读写分离
- [ ] CDN加速
- [ ] 服务拆分（微服务）

---

## 十、文档索引

| 文档 | 路径 | 说明 |
|-----|------|------|
| 实施计划 | `docs/IMPLEMENTATION_PLAN.md` | 本文档 |
| 环境搭建 | `docs/SETUP_GUIDE.md` | 开发环境安装指南 |
| 数据库设计 | `docs/DATABASE_DESIGN.md` | 数据库表结构和SQL |
| API规范 | `docs/API_SPECIFICATION.md` | 接口文档 |
| 开发进度 | `docs/DEVELOPMENT_PROGRESS.md` | 进度追踪 |
| 后端README | `backend/README.md` | 快速开始指南 |

---

## 十一、联系方式

**技术负责人**：Claude (AI)
**项目负责人**：用户
**开始日期**：2025-01-08
**目标上线日期**：2025-04-08（13周后）

---

**文档状态**：✅ 已确认
**最后更新**：2025-01-08
